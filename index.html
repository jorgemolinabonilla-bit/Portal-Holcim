<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CENTRO DE TRABAJO SEGURIDAD PATRIMONIAL | V.1</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Leaflet.js for Interactive Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @keyframes pulse-red {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(237, 28, 22, 0.4);
            }

            70% {
                transform: scale(1.1);
                box-shadow: 0 0 0 10px rgba(237, 28, 22, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(237, 28, 22, 0);
            }
        }

        .pulse-active {
            animation: pulse-red 1.5s infinite;
            color: var(--red-holcim) !important;
        }
    </style>
</head>

<body>
    <header class="header-top">
        <div class="logo-section">
            <div class="holcim-logo-icon"></div>
            <div class="holcim-logo-text">HOLCIM</div>
            <div id="header-site-name"
                style="margin-left: 1rem; padding-left: 1rem; border-left: 1px solid var(--border-gray); color: var(--text-muted); font-size: 0.75rem; font-weight: 600; text-transform: uppercase;">
                CENTRO DE TRABAJO SEGURIDAD PATRIMONIAL <span
                    style="font-size: 0.6rem; background: var(--primary-teal); color: white; padding: 2px 6px; border-radius: 4px; margin-left: 10px;">V.1</span>
            </div>
        </div>

        <div class="search-mockup">
            <i class="fas fa-search" style="color: var(--text-muted);"></i>
            <input type="text" placeholder="Buscar personal, documentos, reportes..." readonly>
        </div>

        <div class="header-actions">
            <div class="lang-switcher">
                <button class="lang-btn active" data-lang="es" onclick="setLanguage('es')">ES</button>
                <button class="lang-btn" data-lang="en" onclick="setLanguage('en')">EN</button>
            </div>
            <div class="clock-display" id="digital-clock">00:00:00</div>
            <div class="user-profile">J</div>
            <button class="btn-logout-header" id="btn-logout-header" title="Cerrar SESIóN">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </header>

    <nav class="nav-bar">
        <ul class="nav-links">
            <li><a href="#" class="nav-link active" data-view="dashboard"><i class="fas fa-id-card"></i> <span
                        data-i18n="nav_dashboard">Control de Acceso</span></a></li>
            <li><a href="#" class="nav-link" data-view="extra-auth"><i class="fas fa-user-check"></i> <span
                        data-i18n="nav_extra_auth">Autorizaciones Extraordinarias</span></a></li>
            <li><a href="#" class="nav-link" data-view="keys"><i class="fas fa-key"></i> <span
                        data-i18n="nav_keys">Control de Llaves</span></a></li>
            <li><a href="#" class="nav-link" data-view="packages"><i class="fas fa-box-open"></i> <span
                        data-i18n="nav_packages">Gestión de Paquetería</span></a></li>
            <li><a href="#" class="nav-link" data-view="forms"><i class="fas fa-file-signature"></i> <span
                        data-i18n="nav_forms">Formularios de Reportes</span></a></li>
            <li><a href="#" class="nav-link" data-view="database"><i class="fas fa-database"></i> <span
                        data-i18n="nav_database">Base de Datos</span></a></li>
            <li><a href="#" class="nav-link" data-view="security-systems"><i class="fas fa-shield-halved"></i>
                    <span>GESTIÓN DE SISTEMAS DE SEGURIDAD</span></a></li>
            <li><a href="#" class="nav-link" data-view="calendar"><i class="fas fa-calendar-alt"></i>
                    <span>CALENDARIO</span></a></li>
            <li><a href="#" class="nav-link" data-view="settings"><i class="fas fa-cog"></i> <span
                        data-i18n="nav_settings">Configuración</span></a></li>
            <li class="theme-switch-container"
                style="margin-top: auto; padding: 1rem 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <button id="theme-toggle" class="btn-theme-toggle" title="Cambiar Modo (Día/Noche)"
                    style="background: none; border: 1px solid rgba(255,255,255,0.2); color: white; width: 100%; padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 0.7rem; font-weight: 700;">
                    <i class="fas fa-moon"></i>
                    <span>MODO NOCHE</span>
                </button>
            </li>
        </ul>
    </nav>

    <!-- Premium Login System -->
    <div id="login-overlay">
        <div class="login-card">
            <div class="holcim-logo-icon"></div>
            <h2 data-i18n="login_title">SEGURIDAD PATRIMONIAL</h2>
            <p style="font-weight: 800; color: var(--primary-teal); margin-top: -10px; margin-bottom: 20px;">VERSIÓN 1.0
            </p>
            <p data-i18n="login_subtitle">Inicie sesión para continuar</p>
            <form id="login-form">
                <div class="login-field-group">
                    <input type="email" id="login-email" placeholder="Email" required>
                </div>
                <div class="login-field-group">
                    <input type="password" id="login-pass" placeholder="Password" required>
                </div>
                <button type="submit" class="btn-login-premium">
                    <span data-i18n="login_btn">ACCEDER</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>
        </div>
    </div>

    <main class="main-wrapper">

        <!-- ===================== DASHBOARD / ACCESS CONTROL ===================== -->
        <div id="dashboard-view" class="view-section">
            <div class="view-header"
                style="margin-bottom: 2.5rem; padding: 2rem; background: linear-gradient(135deg, var(--navy-black), var(--navy-dark)); border-radius: 12px; color: white; box-shadow: var(--card-shadow); border-left: 6px solid var(--primary-teal);">
                <h2
                    style="font-size: 2.2rem; font-weight: 900; text-transform: uppercase; letter-spacing: -1px; margin-bottom: 0;">
                    Centro de Monitoreo y Control de Accesos</h2>
            </div>
            <div class="dashboard-grid">
                <aside class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-user-plus" style="color: var(--primary-teal);"></i> Registro de Ingreso
                        </h3>
                    </div>
                    <div class="panel-body">
                        <form id="access-form">
                            <div class="form-group">
                                <label class="form-label">Número de Cédula</label>
                                <div style="position: relative;">
                                    <input type="text" id="idNumber" placeholder="0-0000-0000" autocomplete="off"
                                        required style="padding-right: 3rem;">
                                    <button type="button" id="btn-scan-id" title="Escanear Código QR/Barras"
                                        style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--primary-teal); cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 4px; transition: background 0.2s;">
                                        <i class="fas fa-qrcode"></i>
                                    </button>
                                    <div id="lookup-indicator"
                                        style="position: absolute; right: 5.5rem; top: 50%; transform: translateY(-50%);">
                                    </div>
                                    <button type="button" id="btn-voice-id" title="Dictar Cédula por Voz"
                                        style="position: absolute; right: 2.8rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 4px; transition: all 0.2s;">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                </div>
                                <div id="induction-alert-box"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">InducciÓn de Seguridad</label>
                                <div class="induction-checkbox">
                                    <input type="checkbox" id="inductionPassed">
                                    <label for="inductionPassed">Registrar InducciÓn realizada hoy</label>
                                </div>
                                <p style="font-size: 0.6rem; color: var(--text-muted); margin-top: 4px;">* VÁlida por 1
                                    aÑo calendario.</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Categoría</label>
                                <select id="visitorType" required>
                                    <option value="" disabled selected>Seleccione tipo...</option>
                                    <option value="VISITANTE">VISITANTE</option>
                                    <option value="PROVEEDOR">PROVEEDOR</option>
                                    <option value="CONTRATISTA">CONTRATISTA</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nombre Completo</label>
                                <input type="text" id="fullName" placeholder="Validación automÁtica Hacienda/TSE"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Empresa / Contratista</label>
                                <input type="text" id="company" placeholder="Nombre de la empresa" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ubicación / Departamento</label>
                                <select id="department" required>
                                    <option value="" disabled selected>Seleccione Departamento</option>
                                    <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                    <option value="PRODUCCION">PRODUCCION</option>
                                    <option value="CALIDAD">CALIDAD</option>
                                    <option value="ADMINISTRACION">ADMINISTRACION</option>
                                    <option value="H&S">H&S / SALUD Y SEGURIDAD</option>
                                    <option value="PROYECTOS">PROYECTOS</option>
                                    <option value="GEOCYCLE">GEOCYCLE</option>
                                    <option value="LOGISTICA">LOGISTICA</option>
                                    <option value="ALMACEN">ALMACEN</option>
                                    <option value="AMBIENTE">AMBIENTE</option>
                                    <option value="COMUNICACION">COMUNICACION</option>
                                    <option value="CEPAL">CEPAL</option>
                                    <option value="PROVEEDURIA">PROVEEDURIA</option>
                                    <option value="TI">TI / TECNOLOGIA</option>
                                    <option value="CETEC">CETEC</option>
                                    <option value="MINERIA">MINERIA</option>
                                    <option value="SERVICIOS GENERALES">SERVICIOS GENERALES</option>
                                    <option value="OTROS">OTROS</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Responsable Holcim</label>
                                <input type="text" id="responsible" placeholder="Persona que autoriza / visita"
                                    required>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Motivo</label>
                                    <select id="reason" required>
                                        <option value="" disabled selected>Seleccione motivo</option>
                                        <option value="REUNION">REUNION</option>
                                        <option value="ENTREGA">ENTREGA</option>
                                        <option value="PASANTIA">PASANTIA</option>
                                        <option value="TRABAJAR">TRABAJAR</option>
                                        <option value="AUDITORIA">AUDITORIA</option>
                                        <option value="OTROS">OTROS</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Placa Vehículo</label>
                                    <input type="text" id="vehiclePlate" placeholder="ABC-123">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Gafete Asignado</label>
                                <select id="badgeNumber" required>
                                    <option value="">Seleccione Gafete...</option>
                                </select>
                            </div>

                            <button type="submit" class="btn-submit-action">REGISTRAR ENTRADA</button>
                        </form>
                    </div>
                </aside>

                <!-- Right: Monitor -->
                <section class="monitor-view">
                    <div class="summary-cards"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="card-stat primary" onclick="showFilteredPersonnel('ALL')" style="cursor:pointer">
                            <div class="stat-content">
                                <h4>Total en Planta</h4>
                                <div class="stat-value" id="count-active">0</div>
                            </div>
                            <i class="fas fa-users stat-icon" style="color: var(--primary-teal);"></i>
                        </div>
                        <div class="card-stat" onclick="showFilteredPersonnel('CONTRATISTA')"
                            style="border-top: 4px solid #10B981; background: #ECFDF5; cursor:pointer">
                            <div class="stat-content">
                                <h4 style="color: #065F46;">Contratistas</h4>
                                <div class="stat-value" id="count-contractors" style="color: #047857;">0</div>
                            </div>
                            <i class="fas fa-hard-hat stat-icon" style="color: #10B981; opacity:0.2"></i>
                        </div>
                        <div class="card-stat" onclick="showFilteredPersonnel('VISITANTE')"
                            style="border-top: 4px solid #F59E0B; background: #FFFBEB; cursor:pointer">
                            <div class="stat-content">
                                <h4 style="color: #92400E;">Visitas</h4>
                                <div class="stat-value" id="count-visitors" style="color: #B45309;">0</div>
                            </div>
                            <i class="fas fa-user-tie stat-icon" style="color: #F59E0B; opacity:0.2"></i>
                        </div>
                        <div class="card-stat" onclick="showFilteredPersonnel('PROVEEDOR')" style="cursor:pointer">
                            <div class="stat-content">
                                <h4>Proveedores</h4>
                                <div class="stat-value" id="count-providers" style="color: var(--navy-black);">0</div>
                            </div>
                            <i class="fas fa-truck-loading stat-icon" style="color: var(--text-muted); opacity:0.3"></i>
                        </div>
                        <div class="card-stat alert" id="btn-show-alerts" onclick="showOvertimeAlerts()">
                            <div class="stat-content">
                                <h4>Alertas (+12h)</h4>
                                <div class="stat-value red-text" id="count-alerts">0</div>
                            </div>
                            <i class="fas fa-exclamation-triangle stat-icon" style="color: var(--red-holcim);"></i>
                        </div>
                    </div>

                    <div class="card-panel">
                        <div class="panel-header"
                            style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <h3><i class="fas fa-desktop" style="color: var(--primary-teal);"></i> Monitoreo en Vivo
                            </h3>

                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="btn-export" onclick="switchView('reports')"
                                    style="background: var(--navy-black); padding: 5px 12px; font-size: 0.75rem;"><i
                                        class="fas fa-file-invoice"></i> Reportes</button>
                                <button class="btn-export" onclick="switchView('inductions')"
                                    style="background: var(--primary-teal); padding: 5px 12px; font-size: 0.75rem;"><i
                                        class="fas fa-clipboard-check"></i> Inducciones</button>
                                <button class="btn-export" onclick="openEmergencyDirectory()"
                                    style="background: #e11d48; padding: 5px 12px; font-size: 0.75rem;"><i
                                        class="fas fa-phone-alt"></i> Directorio</button>

                                <div style="width: 1px; height: 20px; background: #ddd; margin: 0 5px;"></div>

                                <div style="position: relative; width: 200px;">
                                    <i class="fas fa-search"
                                        style="position: absolute; left: 0.8rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 0.75rem;"></i>
                                    <input type="text" id="monitor-search" placeholder="Buscar..."
                                        style="padding-left: 2rem; height: 32px; font-size: 0.8rem; border-radius: 4px; border: 1px solid var(--border-gray); width: 100%;">
                                </div>

                                <select id="filter-monitor-category"
                                    style="height: 32px; font-size: 0.75rem; border-radius: 4px; border: 1px solid var(--border-gray); font-weight: 600;">
                                    <option value="ALL">TODAS LAS CATEGORÍAS</option>
                                    <option value="VISITANTE">VISITANTES</option>
                                    <option value="PROVEEDOR">PROVEEDORES</option>
                                    <option value="CONTRATISTA">CONTRATISTAS</option>
                                </select>

                                <div class="export-actions">
                                    <button class="btn-export" onclick="exportMonitor('xlsx')" title="Exportar Excel"><i
                                            class="fas fa-file-excel"></i></button>
                                    <button class="btn-export" style="background: var(--red-holcim);"
                                        onclick="window.print()" title="Imprimir PDF"><i
                                            class="fas fa-file-pdf"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="card-panel" style="margin-top: 1rem;">
                            <div class="monitor-list">
                                <div class="list-head"
                                    style="grid-template-columns: 80px 1fr 80px 130px 130px 100px 120px 100px;">
                                    <span>Gafete</span>
                                    <span>Visitante / Empresa</span>
                                    <span style="font-size: 0.75rem;">Placa</span>
                                    <span>Departamento</span>
                                    <span>Responsable</span>
                                    <span>Motivo</span>
                                    <span>Ingreso</span>
                                    <span>AcciÓn</span>
                                </div>
                                <div id="monitor-list-body"><!-- Dynamic rows --></div>
                                <div id="empty-state"
                                    style="padding: 5rem; text-align: center; color: var(--text-muted);">
                                    <i class="fas fa-user-clock fa-3x" style="margin-bottom: 1.5rem; opacity: 0.1;"></i>
                                    <p style="font-size: 0.85rem; font-weight: 600;">No hay personal registrado en
                                        planta actualmente.</p>
                                </div>
                            </div>
                        </div>
                </section>
            </div>
        </div>

        <!-- ===================== REPORTS ===================== -->
        <div id="reports-view" class="view-section" style="display: none;">
            <div class="card-panel">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-file-invoice" style="color: var(--primary-teal);"></i> Histórico y Reportes de
                        Planta</h3>
                    <div class="export-actions">
                        <button class="btn-export" style="background: var(--primary-teal);"
                            onclick="renderMonthlyContractorConsolidated()"><i class="fas fa-calculator"></i>
                            Consolidado Contratistas</button>
                        <button class="btn-export" onclick="exportData('xlsx')"><i class="fas fa-file-excel"></i>
                            Excel</button>
                        <button class="btn-export" style="background: var(--red-holcim);" onclick="printReport()"><i
                                class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="filter-bar">
                    <div class="filter-group">
                        <label>Desde / Hasta</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="date" id="filter-date-start">
                            <input type="date" id="filter-date-end">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>BÚsqueda General</label>
                        <input type="text" id="report-search" placeholder="Nombre, Cédula, Empresa...">
                    </div>
                    <div class="filter-group">
                        <label>Tipo de Visitante</label>
                        <select id="filter-visitor-type">
                            <option value="ALL">TODOS</option>
                            <option value="VISITANTE">VISITANTE</option>
                            <option value="PROVEEDOR">PROVEEDOR</option>
                            <option value="CONTRATISTA">CONTRATISTA</option>
                        </select>
                    </div>
                </div>
                <div class="monitor-list">
                    <div class="list-head" style="grid-template-columns: 140px 1fr 140px 140px 110px 110px 130px;">
                        <span>Fecha / ID</span>
                        <span>Personal</span>
                        <span>Empresa</span>
                        <span>Responsable</span>
                        <span>Entrada</span>
                        <span>Salida</span>
                        <span>Estado</span>
                    </div>
                    <div id="report-list-body"><!-- History rows --></div>
                </div>
            </div>
        </div>

        <!-- ===================== INDUCTIONS ===================== -->
        <div id="inductions-view" class="view-section" style="display: none;">
            <div class="card-panel">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-shield-alt" style="color: var(--primary-teal);"></i> Base de Datos de
                        Inducciones</h3>
                    <div class="export-actions">
                        <button class="btn-export" onclick="exportInductions('xlsx')"><i class="fas fa-file-excel"></i>
                            Excel</button>
                        <button class="btn-export" style="background: var(--red-holcim);" onclick="window.print()"><i
                                class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="filter-bar" style="grid-template-columns: 1fr 1fr 200px;">
                    <div class="filter-group">
                        <label>BÚsqueda Personal</label>
                        <input type="text" id="induction-search" placeholder="Cédula, Nombre o Empresa...">
                    </div>
                    <div class="filter-group">
                        <label>Fecha de InducciÓn (Rango)</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="date" id="ind-date-start">
                            <input type="date" id="ind-date-end">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Estado de Vigencia</label>
                        <select id="filter-ind-status">
                            <option value="ALL">TODOS</option>
                            <option value="valid">VIGENTE</option>
                            <option value="expired">VENCIDA</option>
                        </select>
                    </div>
                </div>
                <div class="monitor-list">
                    <div class="list-head" style="grid-template-columns: 120px 1fr 140px 140px 120px 100px;">
                        <span>Cédula</span>
                        <span>Nombre Completo</span>
                        <span>Empresa</span>
                        <span>Departamento</span>
                        <span>Última Ind.</span>
                        <span>Estado</span>
                    </div>
                    <div id="induction-list-body"><!-- Induction database rows --></div>
                </div>
            </div>
        </div>

        <!-- ===================== EXTRA AUTH ===================== -->
        <div id="extra-auth-view" class="view-section" style="display: none;">
            <div class="dashboard-grid" style="grid-template-columns: 380px 1fr;">
                <aside class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-file-contract" style="color: var(--primary-teal);"></i> Nueva Autorización
                        </h3>
                    </div>
                    <div class="panel-body">
                        <form id="auth-form">
                            <div class="form-group">
                                <label class="form-label">Nombre del Beneficiario</label>
                                <input type="text" id="auth-name" placeholder="Nombre completo" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Empresa</label>
                                <input type="text" id="auth-company" placeholder="Empresa externa / Contratista"
                                    required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Persona que Autoriza</label>
                                <input type="text" id="auth-approver" placeholder="Nombre del responsable Holcim"
                                    required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Fecha EmisiÓn</label>
                                    <input type="date" id="auth-date-start" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Fecha ExpiraciÓn</label>
                                    <input type="date" id="auth-date-end" required>
                                </div>
                            </div>
                            <button type="submit" class="btn-submit-action">GUARDAR AUTORIZACIóN</button>
                        </form>
                    </div>
                </aside>
                <section class="monitor-view">
                    <div class="card-panel">
                        <div class="panel-header"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <h3><i class="fas fa-database" style="color: var(--primary-teal);"></i> Base de Datos de
                                Autorizaciones</h3>
                            <div class="export-actions">
                                <button class="btn-export" onclick="exportAuth('xlsx')"><i
                                        class="fas fa-file-excel"></i> Excel</button>
                                <button class="btn-export" style="background: var(--red-holcim);"
                                    onclick="window.print()"><i class="fas fa-file-pdf"></i> PDF</button>
                            </div>
                        </div>
                        <div class="filter-bar" style="grid-template-columns: 1fr 1fr 120px 120px;">
                            <div class="filter-group">
                                <label>Persona</label>
                                <input type="text" id="auth-search-name" placeholder="Nombre...">
                            </div>
                            <div class="filter-group">
                                <label>Empresa</label>
                                <input type="text" id="auth-search-company" placeholder="Empresa...">
                            </div>
                            <div class="filter-group">
                                <label>Estado</label>
                                <select id="auth-filter-status">
                                    <option value="ALL">TODOS</option>
                                    <option value="VIGENTE">VIGENTE</option>
                                    <option value="POR VENCER">POR VENCER</option>
                                    <option value="VENCIDA">VENCIDA</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Filtrar por Mes</label>
                                <input type="month" id="auth-filter-date">
                            </div>
                        </div>
                        <div class="monitor-list">
                            <div class="list-head" style="grid-template-columns: 1fr 150px 140px 110px 110px 100px;">
                                <span>Persona</span>
                                <span>Empresa</span>
                                <span>Autoriza</span>
                                <span>EmisiÓn</span>
                                <span>Expira</span>
                                <span>Estado</span>
                            </div>
                            <div id="auth-list-body"><!-- Auth rows --></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- ===================== KEYS ===================== -->
        <div id="keys-view" class="view-section" style="display: none;">
            <div class="dashboard-grid" style="grid-template-columns: 380px 1fr;">
                <aside class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-key" style="color: var(--primary-teal);"></i> Registro de Préstamo</h3>
                    </div>
                    <div class="panel-body">
                        <form id="key-loan-form">
                            <div class="form-group">
                                <label class="form-label">Número de Llave</label>
                                <input type="number" id="key-number" placeholder="Ej: 1" required>
                                <div id="key-security-alert" style="margin-top: 10px;"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nombre de la Llave (Auto)</label>
                                <input type="text" id="key-name" placeholder="Escriba número para autocompletar"
                                    readonly style="background: #f8fafc;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Persona que solicita</label>
                                <input type="text" id="key-requestor" placeholder="Nombre completo" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Oficial que entrega</label>
                                <input type="text" id="key-officer" list="officers-list"
                                    placeholder="Nombre del oficial" required>
                            </div>
                            <button type="submit" class="btn-submit-action">REGISTRAR PrÉstamo</button>
                        </form>
                    </div>
                </aside>
                <section class="monitor-view">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-history" style="color: var(--primary-teal);"></i> Llaves en Préstamo
                                Activo</h3>
                        </div>
                        <div class="monitor-list">
                            <div class="list-head" style="grid-template-columns: 80px 100px 1fr 1fr 1fr 120px;">
                                <span>Num</span>
                                <span>Hora</span>
                                <span>Llave</span>
                                <span>Solicitante</span>
                                <span>Oficial</span>
                                <span>AcciÓn</span>
                            </div>
                            <div id="key-list-body"><!-- Active loans --></div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="card-panel" style="margin-top: 1.5rem;">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-archive" style="color: var(--primary-teal);"></i> Historial y Reportes de
                        Préstamos</h3>
                    <div class="export-actions">
                        <button class="btn-export" onclick="exportKeyHistory('xlsx')"><i class="fas fa-file-excel"></i>
                            Excel</button>
                        <button class="btn-export" style="background: var(--red-holcim);" onclick="window.print()"><i
                                class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="filter-bar" style="grid-template-columns: 100px 1fr 1fr;">
                    <div class="filter-group">
                        <label>Num. Llave</label>
                        <input type="number" id="filter-key-num" placeholder="00">
                    </div>
                    <div class="filter-group">
                        <label>Nombre de Llave</label>
                        <input type="text" id="filter-key-name" placeholder="Ej: PortÓn 1...">
                    </div>
                    <div class="filter-group">
                        <label>Solicitante</label>
                        <input type="text" id="filter-key-requestor" placeholder="Nombre de la persona...">
                    </div>
                </div>
                <div class="monitor-list">
                    <div class="list-head" style="grid-template-columns: 60px 1fr 1fr 1fr 125px 125px 90px;">
                        <span>Num</span>
                        <span>Llave</span>
                        <span>Solicitante</span>
                        <span>Oficial</span>
                        <span>Préstamo</span>
                        <span>DevoluciÓn</span>
                        <span>Estado</span>
                    </div>
                    <div id="key-history-body"><!-- History rows --></div>
                </div>
            </div>
        </div>

        <!-- ===================== PACKAGE MANAGEMENT ===================== -->
        <div id="packages-view" class="view-section" style="display: none;">
            <div class="dashboard-grid">
                <!-- Registration Form -->
                <aside class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-box" style="color: var(--primary-teal);"></i> Registro de Paquetería</h3>
                    </div>
                    <div class="panel-body">
                        <form id="package-form">
                            <div class="form-group">
                                <label class="form-label">Mensajero / Empresa</label>
                                <input type="text" id="pkg-courier" placeholder="DHL, Correos, Emisarios..." required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Destinatario</label>
                                <input type="text" id="pkg-recipient" placeholder="Persona o departamento que recibe"
                                    required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Oficial que Recibe</label>
                                <input type="text" id="pkg-officer" list="officers-list"
                                    placeholder="Nombre del oficial de seguridad" required>
                            </div>
                            <button type="submit" class="btn-submit-action" style="margin-top: 1rem;"><i
                                    class="fas fa-plus"></i> REGISTRAR PAQUETE</button>
                        </form>
                    </div>
                </aside>

                <!-- Pending Package List -->
                <section class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-boxes" style="color: var(--primary-teal);"></i> Paquetes Pendientes de
                            Entrega</h3>
                    </div>
                    <div class="monitor-list">
                        <div class="list-head" style="grid-template-columns: 1fr 1fr 150px 150px 100px;">
                            <span>MensajerÍa</span>
                            <span>Para</span>
                            <span>Recibido por (Seg)</span>
                            <span>Fecha Recibido</span>
                            <span>AcciÓn</span>
                        </div>
                        <div id="package-list-body" style="max-height: 420px; overflow-y: auto;">
                            <!-- Dynamic Content -->
                        </div>
                    </div>
                </section>
            </div>

            <!-- Delivery History -->
            <div class="card-panel" style="margin-top: 2rem;">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-history" style="color: var(--text-muted);"></i> Historial de Entregas Recientes
                    </h3>
                    <div class="export-actions">
                        <button class="btn-export" onclick="exportPackages('xlsx')"><i class="fas fa-file-excel"></i>
                            Excel</button>
                        <button class="btn-export" style="background: var(--red-holcim);" onclick="window.print()"><i
                                class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="filter-bar" style="grid-template-columns: 1fr 150px 150px 120px;">
                    <div class="filter-group">
                        <label>Buscador (MensajerÍa/Para)</label>
                        <input type="text" id="pkg-search" placeholder="Buscar...">
                    </div>
                    <div class="filter-group">
                        <label>Desde</label>
                        <input type="date" id="pkg-filter-start">
                    </div>
                    <div class="filter-group">
                        <label>Hasta</label>
                        <input type="date" id="pkg-filter-end">
                    </div>
                    <div class="filter-group">
                        <label>Estado</label>
                        <select id="pkg-filter-status">
                            <option value="ALL">TODOS</option>
                            <option value="PENDIENTE">PENDIENTE</option>
                            <option value="ENTREGADO">ENTREGADO</option>
                        </select>
                    </div>
                </div>
                <div class="monitor-list">
                    <div class="list-head" style="grid-template-columns: 1fr 1fr 150px 150px 150px 150px 80px;">
                        <span>MensajerÍa</span>
                        <span>Para</span>
                        <span>Recibido por (Seg)</span>
                        <span>Fecha Recibido</span>
                        <span>Entregado a (Per)</span>
                        <span>Fecha Entrega</span>
                        <span>Estado</span>
                    </div>
                    <div id="package-history-body" style="max-height: 300px; overflow-y: auto;">
                        <!-- Dynamic Content -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== FORMS ===================== -->
        <div id="forms-view" class="view-section" style="display: none;">
            <div class="panel-header" style="margin-bottom: 2rem;">
                <h3><i class="fas fa-file-signature" style="color: var(--primary-teal);"></i> Formularios de Reportes
                    Externos</h3>
                <p style="color: var(--text-muted); font-size: 0.8rem;">Acceda rÁpidamente a las herramientas de reporte
                    oficial de Holcim.</p>
            </div>
            <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
                <div class="card-panel"
                    style="display: flex; flex-direction: column; justify-content: space-between; border-top: 4px solid var(--navy-black);">
                    <div class="panel-body" style="padding: 2rem; text-align: center;">
                        <i class="fas fa-file-invoice"
                            style="font-size: 3rem; color: var(--navy-black); margin-bottom: 1.5rem;"></i>
                        <h4 style="font-weight: 800; color: var(--navy-black); margin-bottom: 1rem;">REPORTE DE
                            SEGURIDAD
                            INTERNO (PDF)</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 2rem;">Generación de
                            reportes
                            ejecutivos de eventos o incidentes para descarga inmediata.</p>
                        <button onclick="openSafetyReportModal()" class="btn-submit-action"
                            style="background: var(--navy-black); display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-edit"></i> CREAR REPORTE
                        </button>
                    </div>
                </div>
                <div class="card-panel"
                    style="display: flex; flex-direction: column; justify-content: space-between; border-top: 4px solid var(--primary-teal);">
                    <div class="panel-body" style="padding: 2rem; text-align: center;">
                        <i class="fas fa-shield-dog"
                            style="font-size: 3rem; color: var(--primary-teal); margin-bottom: 1.5rem;"></i>
                        <h4 style="font-weight: 800; color: var(--navy-black); margin-bottom: 1rem;">HERRAMIENTA DE
                            REPORTES DE SEGURIDAD K9</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 2rem;">Registro y
                            seguimiento de actividades de seguridad canina en planta.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeUrSKsomZnlLrkRl1-nElYrQ5sAJYGezqr3HDM-6VwK7apig/viewform"
                            target="_blank" class="btn-submit-action"
                            style="text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-external-link-alt"></i> ABRIR FORMULARIO
                        </a>
                    </div>
                </div>
                <div class="card-panel"
                    style="display: flex; flex-direction: column; justify-content: space-between; border-top: 4px solid var(--red-holcim);">
                    <div class="panel-body" style="padding: 2rem; text-align: center;">
                        <i class="fas fa-vial-circle-check"
                            style="font-size: 3rem; color: var(--red-holcim); margin-bottom: 1.5rem;"></i>
                        <h4 style="font-weight: 800; color: var(--navy-black); margin-bottom: 1rem;">REGISTRO DE
                            ALCOHOLEMIAS HOLCIM</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 2rem;">Control y registro
                            de pruebas de alcoholemia preventivas.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSewEdXOev4T8QlHeMa0hfJE3y_BY4IUNIrkpocLVi6wFLFufg/viewform"
                            target="_blank" class="btn-submit-action"
                            style="background: var(--red-holcim); text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-external-link-alt"></i> ABRIR FORMULARIO
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== BASE DE DATOS ===================== -->
        <div id="database-view" class="view-section" style="display: none;">
            <div class="panel-header" style="margin-bottom: 2rem;">
                <h3><i class="fas fa-database" style="color: var(--primary-teal);"></i> Gestión de Base de Datos</h3>
                <p style="color: var(--text-muted); font-size: 0.8rem;">Administre inventarios y directorios maestros
                    del sistema.</p>
            </div>

            <!-- Database Tab Navigation -->
            <div
                style="display: flex; gap: 10px; margin-bottom: 2rem; border-bottom: 1px solid #ddd; padding-bottom: 10px; overflow-x: auto;">
                <button class="btn-export db-tab-btn active" onclick="switchDbTab('keys-tab', this)"
                    style="background: var(--navy-black);"><i class="fas fa-key"></i> Inventario de Llaves</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('badges-tab', this)"
                    style="background: #8b5cf6;"><i class="fas fa-id-badge"></i> Inventario de Carnets</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('personnel-tab', this)"
                    style="background: var(--primary-teal);"><i class="fas fa-address-book"></i> Directorio de
                    Personal</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('officers-tab', this)"
                    style="background: #64748b;"><i class="fas fa-shield-alt"></i> Oficiales de Seguridad</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('contact-tab', this)"
                    style="background: #e11d48;"><i class="fas fa-phone-alt"></i> Directorio de Planta</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('cctv-tab', this)"
                    style="background: #1e293b;"><i class="fas fa-video"></i> Inventario CCTV</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('access-points-tab', this)"
                    style="background: #0d9488;"><i class="fas fa-door-open"></i> Puntos de Acceso</button>
            </div>

            <div id="db-tabs-container">
                <!-- Keys Tab -->
                <div id="keys-tab" class="db-tab-content">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-key"></i> Maestro de Llaves</h4>
                        </div>
                        <div class="panel-body">
                            <form id="db-key-form"
                                style="display: grid; grid-template-columns: 80px 1fr 1fr 140px 100px; gap: 10px; align-items: end; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Num</label>
                                    <input type="number" id="db-key-num" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nombre / Ubicación</label>
                                    <input type="text" id="db-key-name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Alerta de Seguridad (Opcional)</label>
                                    <input type="text" id="db-key-alert"
                                        placeholder="Ej: Requiere AUTORIZACIóN de Gerencia">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Estado</label>
                                    <select id="db-key-status">
                                        <option value="OPERATIVA">OPERATIVA</option>
                                        <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                        <option value="EXTRAVIADA">EXTRAVIADA</option>
                                        <option value="RESTRINGIDA">RESTRINGIDA</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn-submit-action" style="height: 38px;"><i
                                        class="fas fa-plus"></i></button>
                            </form>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 60px 1fr 120px 80px;">
                                    <span>Num</span>
                                    <span>Ubicación</span>
                                    <span>Estado</span>
                                    <span>AcciÓn</span>
                                </div>
                                <div id="db-key-list-body"><!-- Keys CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Badges Tab -->
                <div id="badges-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-id-badge"></i> Maestro de Carnets de Visitantes</h4>
                        </div>
                        <div class="panel-body">
                            <form id="db-badge-form"
                                style="display: grid; grid-template-columns: 120px 120px 1fr 100px; gap: 10px; align-items: end; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Num Carnet</label>
                                    <input type="text" id="db-badge-num" placeholder="Ej: 001" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Código Interno</label>
                                    <input type="text" id="db-badge-code" placeholder="ABC-123" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Alerta / Nota (Opcional)</label>
                                    <input type="text" id="db-badge-alert" placeholder="Ej: Carnet con falla en chip">
                                </div>
                                <button type="submit" class="btn-submit-action" style="height: 38px;"><i
                                        class="fas fa-plus"></i></button>
                            </form>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 100px 120px 1fr 80px;">
                                    <span>Carnet #</span>
                                    <span>Código</span>
                                    <span>Alertas / Notas</span>
                                    <span>AcciÓn</span>
                                </div>
                                <div id="db-badge-list-body"><!-- Badges CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personnel Tab -->
                <div id="personnel-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-address-book"></i> Maestro de Personal</h4>
                        </div>
                        <div class="panel-body">
                            <form id="db-person-form"
                                style="display: grid; grid-template-columns: 1fr 1fr 100px; gap: 10px; align-items: end; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Nombre Completo</label>
                                    <input type="text" id="db-person-name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Departamento</label>
                                    <select id="db-person-dept" required>
                                        <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                        <option value="PRODUCCION">PRODUCCION</option>
                                        <option value="CALIDAD">CALIDAD</option>
                                        <option value="ADMINISTRACION">ADMINISTRACION</option>
                                        <option value="H&S">H&S / SALUD Y SEGURIDAD</option>
                                        <option value="PROYECTOS">PROYECTOS</option>
                                        <option value="GEOCYCLE">GEOCYCLE</option>
                                        <option value="LOGISTICA">LOGISTICA</option>
                                        <option value="ALMACEN">ALMACEN</option>
                                        <option value="AMBIENTE">AMBIENTE</option>
                                        <option value="COMUNICACION">COMUNICACION</option>
                                        <option value="CEPAL">CEPAL</option>
                                        <option value="PROVEEDURIA">PROVEEDURIA</option>
                                        <option value="TI">TI / TECNOLOGIA</option>
                                        <option value="CETEC">CETEC</option>
                                        <option value="MINERIA">MINERIA</option>
                                        <option value="SERVICIOS GENERALES">SERVICIOS GENERALES</option>
                                        <option value="OTROS">OTROS</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn-submit-action" style="height: 38px;"><i
                                        class="fas fa-user-plus"></i></button>
                            </form>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 1fr 120px 80px;">
                                    <span>Nombre</span>
                                    <span>Departamento</span>
                                    <span>AcciÓn</span>
                                </div>
                                <div id="db-person-list-body"><!-- Personnel CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Officers Tab -->
                <div id="officers-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-shield-alt"></i> Maestro de Oficiales</h4>
                        </div>
                        <div class="panel-body">
                            <form id="db-officer-form"
                                style="display: grid; grid-template-columns: 1fr 1fr 100px; gap: 10px; align-items: end; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Nombre del Oficial</label>
                                    <input type="text" id="db-officer-name" placeholder="Nombre completo" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Empresa de Seguridad</label>
                                    <input type="text" id="db-officer-company" placeholder="Ej: G4S, Vigilantes..."
                                        required>
                                </div>
                                <button type="submit" class="btn-submit-action" style="height: 38px;"><i
                                        class="fas fa-plus"></i></button>
                            </form>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 1fr 1fr 80px;">
                                    <span>Oficial</span>
                                    <span>Empresa</span>
                                    <span>AcciÓn</span>
                                </div>
                                <div id="db-officer-list-body"><!-- Officers CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Contact Directory Tab -->
                <div id="contact-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-phone-alt"></i> Directorio de Contactos de Planta</h4>
                        </div>
                        <div class="panel-body">
                            <div
                                style="background: rgba(225, 29, 72, 0.05); padding: 1.5rem; border-radius: 8px; border: 1px dashed #e11d48; margin-bottom: 2rem;">
                                <h5 style="margin-top: 0; margin-bottom: 1rem; color: #e11d48;"><i
                                        class="fas fa-plus-circle"></i> Registrar Nuevo Contacto</h5>
                                <form id="db-contact-form"
                                    style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 100px; gap: 15px; align-items: end;">
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label">Nombre / Cargo</label>
                                        <input type="text" id="db-contact-name" placeholder="Ej: Jefe de Turno"
                                            required>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label">Departamento</label>
                                        <select id="db-contact-dept" required>
                                            <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                            <option value="PRODUCCION">PRODUCCION</option>
                                            <option value="CALIDAD">CALIDAD</option>
                                            <option value="ADMINISTRACION">ADMINISTRACION</option>
                                            <option value="H&S">H&S / SALUD Y SEGURIDAD</option>
                                            <option value="PROYECTOS">PROYECTOS</option>
                                            <option value="GEOCYCLE">GEOCYCLE</option>
                                            <option value="LOGISTICA">LOGISTICA</option>
                                            <option value="ALMACEN">ALMACEN</option>
                                            <option value="AMBIENTE">AMBIENTE</option>
                                            <option value="COMUNICACION">COMUNICACION</option>
                                            <option value="CEPAL">CEPAL</option>
                                            <option value="PROVEEDURIA">PROVEEDURIA</option>
                                            <option value="TI">TI / TECNOLOGIA</option>
                                            <option value="CETEC">CETEC</option>
                                            <option value="MINERIA">MINERIA</option>
                                            <option value="SERVICIOS GENERALES">SERVICIOS GENERALES</option>
                                            <option value="OTROS">OTROS</option>
                                        </select>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label">Teléfono / Ext</label>
                                        <input type="text" id="db-contact-phone" placeholder="Ej: 8888-8888" required>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label">Canal de Radio</label>
                                        <input type="text" id="db-contact-radio" placeholder="Ej: Canal 5">
                                    </div>
                                    <button type="submit" class="btn-submit-action"
                                        style="height: 42px; background: #e11d48; width: 100%;"><i
                                            class="fas fa-save"></i> GUARDAR</button>
                                </form>
                            </div>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 1fr 120px 120px 100px 80px;">
                                    <span>Nombre</span>
                                    <span>Depto</span>
                                    <span>Teléfono</span>
                                    <span>Radio</span>
                                    <span>AcciÓn</span>
                                </div>
                                <div id="db-contact-list-body"><!-- Contacts CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CCTV Tab -->
                <div id="cctv-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-video"></i> Maestro de Sistemas CCTV</h4>
                        </div>
                        <div class="panel-body">
                            <form id="db-cctv-form"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)) 80px; gap: 10px; align-items: end; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Tipo Dispositivo</label>
                                    <select id="db-cctv-type" required>
                                        <option value="CAMARA DOMO">Cámara DOMO</option>
                                        <option value="CAMARA FIJA">Cámara Fija</option>
                                        <option value="CAMARA PTZ">Cámara PTZ</option>
                                        <option value="PC">Computadora (PC)</option>
                                        <option value="PANEL ALARMA">Panel de Alarma</option>
                                        <option value="SENSOR ALARMA">Sensor de Alarma</option>
                                        <option value="GRABADOR DVR">Grabador DVR</option>
                                        <option value="GRABADOR NVR">Grabador NVR</option>
                                        <option value="LECTORA ACCESO">Lectora de Acceso</option>
                                        <option value="BARRERA VEHICULAR">Barrera Vehicular</option>
                                        <option value="TROMPO / TORNIQUETE">Trompo / Torniquete</option>
                                        <option value="VIDEO PORTERO">Video Portero</option>
                                        <option value="SOFTWARE / SERVIDOR">Software / Servidor</option>
                                        <option value="PANTALLA">Pantalla / Monitor</option>
                                        <option value="OTROS">Otros</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Marca</label>
                                    <input type="text" id="db-cctv-brand" placeholder="Hikvision, Bosch...">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Dirección IP</label>
                                    <input type="text" id="db-cctv-ip" placeholder="10.0.0.0" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ubicación</label>
                                    <input type="text" id="db-cctv-location" placeholder="Ej: PortÓn 1" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Estado</label>
                                    <select id="db-cctv-status">
                                        <option value="OPERATIVO">Operativo</option>
                                        <option value="FALLA">Falla</option>
                                        <option value="MANTENIMIENTO">Mantenimiento</option>
                                        <option value="FUERA DE SERVICIO">Fuera de Servicio</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Observación</label>
                                    <input type="text" id="db-cctv-obs" placeholder="Notas...">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Latitud</label>
                                    <div style="display: flex; gap: 5px;">
                                        <input type="number" id="db-cctv-lat" step="any" placeholder="Lat...">
                                        <button type="button" class="btn-salida-corpo"
                                            onclick="openMapPicker('db-cctv-lat', 'db-cctv-lng')"
                                            style="width: 40px; padding: 0;"><i
                                                class="fas fa-location-dot"></i></button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Longitud</label>
                                    <input type="number" id="db-cctv-lng" step="any" placeholder="Lng...">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Foto Ref.</label>
                                    <input type="file" id="db-cctv-photo" accept="image/*" class="custom-file-input">
                                </div>
                                <div class="form-group" style="grid-column: span 2;">
                                    <label class="form-label">Analíticas Activas</label>
                                    <div class="analytics-checkbox-grid">
                                        <label><input type="checkbox" name="cctv-analytics" value="CRUCE"><span>Cruce
                                                Línea</span></label>
                                        <label><input type="checkbox" name="cctv-analytics"
                                                value="INTRUSION"><span>Intrusión</span></label>
                                        <label><input type="checkbox" name="cctv-analytics"
                                                value="MERODEO"><span>Merodeo</span></label>
                                        <label><input type="checkbox" name="cctv-analytics"
                                                value="OBJETO"><span>Objeto</span></label>
                                        <label><input type="checkbox" name="cctv-analytics"
                                                value="ROSTRO"><span>Rostro</span></label>
                                        <label><input type="checkbox" name="cctv-analytics"
                                                value="CONTEO"><span>Conteo</span></label>
                                        <label><input type="checkbox" name="cctv-analytics"
                                                value="SABOTAJE"><span>Sabotaje</span></label>
                                        <label><input type="checkbox" name="cctv-analytics"
                                                value="AUDIO"><span>Audio</span></label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Horario</label>
                                    <input type="text" id="db-cctv-analytics-schedule" placeholder="18:00 - 05:00">
                                </div>
                                <button type="submit" class="btn-submit-action" style="height: 38px;"><i
                                        class="fas fa-plus"></i></button>
                            </form>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head"
                                    style="grid-template-columns: 100px 100px 90px 1fr 100px 140px 100px 60px 80px;">
                                    <span>Tipo</span>
                                    <span>Marca</span>
                                    <span>IP</span>
                                    <span>Ubicación</span>
                                    <span>Estado</span>
                                    <span>Analíticas / Horario</span>
                                    <span>Obs</span>
                                    <span>Foto</span>
                                    <span>AcciÓn</span>
                                </div>
                                <div id="db-cctv-list-body"><!-- CCTV CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Access Points Tab -->
                <div id="access-points-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-door-open"></i> Inventario de Puntos de Acceso</h4>
                        </div>
                        <div class="panel-body">
                            <div
                                style="background: rgba(13,148,136,0.05); padding: 1.5rem; border-radius: 8px; border: 1px dashed #0d9488; margin-bottom: 2rem;">
                                <h5 style="margin-top: 0; margin-bottom: 1rem; color: #0d9488;"><i
                                        class="fas fa-plus-circle"></i> Registrar Punto de Acceso</h5>
                                <form id="db-access-point-form"
                                    style="display: grid; grid-template-columns: 1fr 1fr 120px 100px 100px 100px 80px; gap: 15px; align-items: end;">
                                    <div class="form-group">
                                        <label class="form-label">Nombre / Descripción</label>
                                        <input type="text" id="db-ap-name" placeholder="Ej: PortÓn Principal" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Ubicación</label>
                                        <input type="text" id="db-ap-location" placeholder="Ej: Entrada Norte" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Tipo</label>
                                        <select id="db-ap-type">
                                            <option value="PortÓn">PortÓn</option>
                                            <option value="PUERTA">Puerta</option>
                                            <option value="BARRERA">Barrera</option>
                                            <option value="TORNIQUETE">Torniquete</option>
                                            <option value="CASETA">Caseta de Control</option>
                                            <option value="OTROS">Otros</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Estado</label>
                                        <select id="db-ap-status">
                                            <option value="OPERATIVO">Operativo</option>
                                            <option value="FALLA">Falla</option>
                                            <option value="MANTENIMIENTO">Mantenimiento</option>
                                            <option value="FUERA DE SERVICIO">Fuera de Servicio</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Latitud</label>
                                        <div style="display: flex; gap: 5px;">
                                            <input type="number" id="db-ap-lat" step="any" placeholder="9.9281">
                                            <button type="button" class="btn-salida-corpo"
                                                onclick="openMapPicker('db-ap-lat', 'db-ap-lng')"
                                                style="width: 40px; padding: 0;"><i
                                                    class="fas fa-location-dot"></i></button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Longitud</label>
                                        <input type="number" id="db-ap-lng" step="any" placeholder="-84.0907">
                                    </div>
                                    <button type="submit" class="btn-submit-action"
                                        style="height: 38px; background: #0d9488;"><i class="fas fa-plus"></i></button>
                                </form>
                                <div
                                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 1rem;">
                                    <div class="form-group">
                                        <label class="form-label">Fotografía del Punto de Acceso</label>
                                        <input type="file" id="db-ap-photo" accept="image/*" class="custom-file-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Observaciones</label>
                                        <input type="text" id="db-ap-obs" placeholder="Notas adicionales...">
                                    </div>
                                </div>
                            </div>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 1fr 1fr 110px 130px 60px 70px;">
                                    <span>Nombre</span>
                                    <span>Ubicación</span>
                                    <span>Tipo</span>
                                    <span>Estado</span>
                                    <span>Foto</span>
                                    <span>AcciÓn</span>
                                </div>
                                <div id="db-access-points-list-body"><!-- Access Points CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== SECURITY SYSTEMS HUB ===================== -->
        <div id="security-systems-view" class="view-section" style="display: none;">
            <!-- Hub Header -->
            <div
                style="background: linear-gradient(135deg, #0f172a, #1e293b); border-radius: 16px; padding: 1.5rem 2rem; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div>
                    <h2
                        style="color: white; font-size: 1.6rem; font-weight: 900; text-transform: uppercase; margin: 0;">
                        <i class="fas fa-shield-halved" style="color: var(--primary-teal);"></i> Gestión de Sistemas de
                        Seguridad
                    </h2>
                    <p style="color: rgba(255,255,255,0.5); font-size: 0.75rem; margin: 0.3rem 0 0;">Monitoreo
                        electrónico, REVISIóN de portones y seguimiento de incidencias</p>
                </div>
                <div id="security-systems-clock"
                    style="color: white; font-size: 1.4rem; font-weight: 900; font-family: monospace; background: rgba(255,255,255,0.05); padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                </div>
            </div>

            <!-- Hub Tab Buttons -->
            <div style="display: flex; gap: 12px; margin-bottom: 2rem;">
                <button class="btn-export security-hub-tab active" onclick="switchSecurityTab('sec-cctv', this)"
                    style="background: var(--navy-black); padding: 12px 24px; font-size: 0.8rem; flex: 1;"><i
                        class="fas fa-video"></i>&nbsp; Monitoreo Seg. Electrónica</button>
                <button class="btn-export security-hub-tab" onclick="switchSecurityTab('sec-portones', this)"
                    style="background: #0d9488; padding: 12px 24px; font-size: 0.8rem; flex: 1;"><i
                        class="fas fa-door-open"></i>&nbsp; Checklist de Puntos de Acceso</button>
            </div>

            <!-- ---- TAB 1: CCTV Monitoring ---- -->
            <div id="sec-cctv-tab" class="security-hub-content">
                <div class="card-panel">
                    <div class="panel-header"
                        style="background: var(--navy-black); display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem;">
                        <h3 style="color: white; margin: 0;"><i class="fas fa-video"></i> Gestión de Monitoreo CCTV</h3>
                        <div class="db-tabs">
                            <button class="btn-export db-tab-btn active" onclick="switchCctvMonTab('mon-daily', this)"
                                style="background: var(--primary-teal); color: white;">Revision Diaria (18:00)</button>
                            <button class="btn-export db-tab-btn" onclick="switchCctvMonTab('mon-rounds', this)"
                                style="background: #64748b; color: white;">Rondas Virtuales</button>
                            <button class="btn-export db-tab-btn" onclick="switchCctvMonTab('mon-history', this)"
                                style="background: #1e293b; color: white;">Historial / Reportes</button>
                            <button class="btn-export db-tab-btn" onclick="toggleCctvMap()"
                                style="background: #0284c7; color: white;"><i class="fas fa-map-location-dot"></i>
                                MAPA</button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <!-- CCTV Map Section -->
                        <div id="cctv-map-wrapper"
                            style="margin-bottom: 2rem; border-radius: 12px; overflow: hidden; border: 1px solid var(--border-gray); display: none;">
                            <div
                                style="background: var(--navy-black); color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.8rem; font-weight: 700;"><i class="fas fa-video"></i>
                                    Ubicación de Cámaras y Dispositivos de Seguridad</span>
                                <button class="btn-export" onclick="toggleCctvMap()"
                                    style="padding: 4px 12px; font-size: 0.7rem; background: rgba(255,255,255,0.1);">CERRAR
                                    MAPA</button>
                            </div>
                            <!-- Map Filters -->
                            <div
                                style="background: #f1f5f9; padding: 10px 15px; border-bottom: 1px solid var(--border-gray); display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px; position: relative;">
                                    <i class="fas fa-search"
                                        style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 0.8rem;"></i>
                                    <input type="text" id="cctv-map-search"
                                        placeholder="Buscar por nombre, ubicación o IP..."
                                        style="width: 100%; padding: 8px 12px 8px 35px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 0.8rem;"
                                        oninput="window.updateCctvMapMarkers()">
                                </div>
                                <select id="cctv-map-filter-type"
                                    style="width: auto; min-width: 140px; padding: 8px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 0.8rem;"
                                    onchange="window.updateCctvMapMarkers()">
                                    <option value="ALL">Todos los Tipos</option>
                                    <option value="PTZ">Cámaras PTZ</option>
                                    <option value="FIJA">Cámaras Fijas</option>
                                    <option value="DOMO">Cámaras Domo</option>
                                    <option value="TERMICA">Cámaras Térmicas</option>
                                    <option value="ANILLO">Anillos de Fibra</option>
                                </select>
                                <select id="cctv-map-filter-status"
                                    style="width: auto; min-width: 140px; padding: 8px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 0.8rem;"
                                    onchange="window.updateCctvMapMarkers()">
                                    <option value="ALL">Todos los Estados</option>
                                    <option value="OPERATIVA">Operativa</option>
                                    <option value="FALLA">Con Falla</option>
                                    <option value="MANTENIMIENTO">En Mantenimiento</option>
                                </select>
                            </div>
                            <div id="cctv-map" style="height: 400px; width: 100%;"></div>
                        </div>

                        <!-- Daily Checklist Tab -->
                        <div id="mon-daily-tab" class="mon-tab-content">
                            <div class="checklist-header"
                                style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="color: var(--navy-black);">Checklist de Funcionamiento Diario</h4>
                                    <p style="font-size: 0.8rem; color: var(--text-muted);">REVISIóN obligatoria de
                                        inventario a las 18:00 Horas.</p>
                                </div>
                                <button class="btn-crear" onclick="saveCctvDailyReview()"><i class="fas fa-save"></i>
                                    GUARDAR REVISIÓN</button>
                            </div>
                            <div id="cctv-daily-checklist-container">
                                <!-- Dynamic checklist rows from inventory -->
                            </div>
                        </div>

                        <!-- Virtual Rounds Tab -->
                        <div id="mon-rounds-tab" class="mon-tab-content" style="display: none;">
                            <div class="checklist-header" style="margin-bottom: 1.5rem;">
                                <h4 style="color: var(--navy-black);">Registro de Rondas Virtuales</h4>
                                <p style="font-size: 0.8rem; color: var(--text-muted);">Horario operativo: 19:00 - 04:00
                                    AM.</p>
                            </div>
                            <form id="cctv-round-form" class="card-panel"
                                style="background: #f8fafc; padding: 1.5rem; border: 1px solid var(--border-gray); margin-bottom: 2rem;">
                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                                    <div class="form-group">
                                        <label class="form-label">Sector / Área Supervisada</label>
                                        <input type="text" id="round-sector" placeholder="Ej: Perímetro Sur, Almacén..."
                                            required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Puntos de Observación</label>
                                        <input type="text" id="round-points" placeholder="Cámaras revisadas">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Estado de Novedad</label>
                                        <select id="round-status">
                                            <option value="SIN NOVEDAD">Sin Novedad</option>
                                            <option value="NOVEDAD LEVE">Novedad Leve</option>
                                            <option value="INCIDENTE">Incidente Detectado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label class="form-label">Detalle de la Ronda / Seguimiento</label>
                                    <textarea id="round-detail"
                                        style="width: 100%; height: 80px; padding: 0.5rem; border-radius: 4px; border: 1px solid #d1d5db;"
                                        placeholder="Describa lo observado..."></textarea>
                                </div>
                                <div style="display: flex; gap: 1rem; align-items: flex-end; margin-top: 1rem;">
                                    <div class="form-group" style="margin: 0;">
                                        <label class="form-label">Adjuntar Evidencia (Foto)</label>
                                        <input type="file" id="round-photo" accept="image/*" class="custom-file-input">
                                    </div>
                                    <button type="submit" class="btn-submit-action" style="margin: 0; height: 42px;"><i
                                            class="fas fa-plus"></i> REGISTRAR RONDA</button>
                                </div>
                            </form>
                            <div id="rounds-list-container"></div>
                        </div>

                        <!-- History Tab -->
                        <div id="mon-history-tab" class="mon-tab-content" style="display: none;">
                            <div
                                style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap;">
                                <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                    <label class="form-label">Filtrar por Fecha</label>
                                    <input type="date" id="history-filter-date">
                                </div>
                                <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                    <label class="form-label">Tipo de Registro</label>
                                    <select id="history-filter-type">
                                        <option value="ALL">Todos los Registros</option>
                                        <option value="DAILY">Revisiones Diarias</option>
                                        <option value="ROUNDS">Rondas Virtuales</option>
                                    </select>
                                </div>
                                <div class="export-actions" style="justify-content: flex-end;">
                                    <button class="btn-export" onclick="exportCctvLogs('xls')"
                                        style="background: #059669;"><i class="fas fa-file-excel"></i> Excel</button>
                                    <button class="btn-export" onclick="exportCctvLogs('pdf')"
                                        style="background: var(--red-holcim);"><i class="fas fa-file-pdf"></i>
                                        PDF</button>
                                </div>
                            </div>
                            <div id="cctv-history-container">
                                <!-- History items rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ---- TAB 2: Gates Checklist ---- -->
            <div id="sec-portones-tab" class="security-hub-content" style="display: none;">
                <div class="card-panel">
                    <div class="panel-header"
                        style="background: linear-gradient(135deg, #0d9488, #0f766e); display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem;">
                        <div>
                            <h3 style="color: white; margin: 0;"><i class="fas fa-door-open"></i> Checklist de
                                Puntos de Acceso (19:00)</h3>
                            <p style="color: rgba(255,255,255,0.7); font-size: 0.75rem; margin: 0.3rem 0 0;">
                                Verificación diaria del estado operativo de los accesos perimetrales</p>
                        </div>
                        <button class="btn-crear" onclick="saveAccessPointReview()"
                            style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3);"><i
                                class="fas fa-save"></i> GUARDAR REVISIÓN</button>
                    </div>
                    <div class="panel-body">
                        <!-- Stats banner -->
                        <div
                            style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div
                                style="background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.2); border-radius: 12px; padding: 1rem; text-align: center;">
                                <div id="portones-stat-ok" style="font-size: 2rem; font-weight: 900; color: #22c55e;">0
                                </div>
                                <div style="font-size: 0.7rem; color: var(--text-muted); font-weight: 700;">OPERATIVOS
                                </div>
                            </div>
                            <div
                                style="background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); border-radius: 12px; padding: 1rem; text-align: center;">
                                <div id="portones-stat-fail" style="font-size: 2rem; font-weight: 900; color: #ef4444;">
                                    0</div>
                                <div style="font-size: 0.7rem; color: var(--text-muted); font-weight: 700;">CON FALLA
                                </div>
                            </div>
                            <div
                                style="background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.2); border-radius: 12px; padding: 1rem; text-align: center;">
                                <div id="portones-stat-maint"
                                    style="font-size: 2rem; font-weight: 900; color: #f59e0b;">0</div>
                                <div style="font-size: 0.7rem; color: var(--text-muted); font-weight: 700;">
                                    MANTENIMIENTO</div>
                            </div>
                            <div
                                style="background: rgba(13,148,136,0.1); border: 1px solid rgba(13,148,136,0.2); border-radius: 12px; padding: 1rem; text-align: center;">
                                <div id="portones-stat-total"
                                    style="font-size: 2rem; font-weight: 900; color: #0d9488;">0</div>
                                <div style="font-size: 0.7rem; color: var(--text-muted); font-weight: 700;">TOTAL
                                    REGISTRADOS</div>
                            </div>
                        </div>

                        <!-- Interactive Map Section -->
                        <div id="ap-map-wrapper"
                            style="margin-bottom: 2rem; border-radius: 12px; overflow: hidden; border: 1px solid var(--border-gray); display: none;">
                            <div
                                style="background: var(--navy-black); color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.8rem; font-weight: 700;"><i class="fas fa-map-marked-alt"></i>
                                    Ubicación Geoespacial de Puntos</span>
                                <button class="btn-export" onclick="toggleAPMap()"
                                    style="padding: 4px 12px; font-size: 0.7rem; background: rgba(255,255,255,0.1);">CERRAR
                                    MAPA</button>
                            </div>
                            <div id="ap-map" style="height: 400px; width: 100%;"></div>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <button class="btn-crear" id="btn-toggle-map" onclick="toggleAPMap()"
                                style="background: var(--primary-teal); width: auto; padding: 10px 20px;">
                                <i class="fas fa-map-location-dot"></i> VER MAPA INTERACTIVO
                            </button>
                        </div>

                        <!-- Checklist Container -->
                        <div id="portones-checklist-container">
                            <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                                <i class="fas fa-door-open"
                                    style="font-size: 3rem; opacity: 0.3; display: block; margin-bottom: 1rem;"></i>
                                <p>No hay puntos de acceso registrados en la base de datos.</p>
                                <p style="font-size: 0.8rem;">Agrega puntos de acceso en la sección <strong>Base de
                                        Datos |
                                        Puntos de Acceso</strong> para que aparezcan aquí.</p>
                            </div>
                        </div>

                        <!-- Observations & Sign-off -->
                        <div
                            style="margin-top: 2rem; border-top: 1px solid var(--border-gray); padding-top: 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Observaciones Generales</label>
                                <textarea id="portones-obs" style="width: 100%; height: 80px; resize: none;"
                                    placeholder="Notas de turno, incidencias, etc..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Oficial que Realiza la REVISIóN</label>
                                <input type="text" id="portones-officer" placeholder="Nombre del oficial">
                                <label class="form-label" style="margin-top: 0.5rem;">Fecha / Hora</label>
                                <input type="datetime-local" id="portones-datetime">
                            </div>
                        </div>

                        <!-- History -->
                        <div style="margin-top: 2rem;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h4 style="margin: 0;"><i class="fas fa-history"></i> Historial de Revisiones</h4>
                                <button class="btn-export" onclick="exportPortonesLogs('pdf')"
                                    style="background: var(--red-holcim);"><i class="fas fa-file-pdf"></i> PDF</button>
                            </div>
                            <div id="portones-history-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- ===================== SETTINGS ===================== -->
        <div id="settings-view" class="view-section" style="display: none;">
            <div class="settings-container">
                <aside class="settings-nav">
                    <div class="settings-nav-item active" onclick="showSettingsSection('profile')"
                        data-section="profile">
                        <i class="fas fa-user-circle"></i>
                        <span data-i18n="settings_nav_profile">Mi Perfil</span>
                    </div>
                    <div class="settings-nav-item" onclick="showSettingsSection('users')" data-section="users">
                        <i class="fas fa-user-shield"></i>
                        <span data-i18n="settings_nav_users">Gestión de Usuarios</span>
                    </div>
                    <div class="settings-nav-item" onclick="showSettingsSection('storage')" data-section="storage">
                        <i class="fas fa-hdd"></i>
                        <span data-i18n="settings_nav_storage">Almacenamiento</span>
                    </div>
                    <div class="settings-nav-item" onclick="showSettingsSection('logs')" data-section="logs">
                        <i class="fas fa-stream"></i>
                        <span data-i18n="settings_nav_logs">Bitácora en Vivo</span>
                    </div>
                    <div style="margin-top: auto; padding-top: 2rem;">
                        <button class="btn-salida-corpo" id="btn-logout"
                            style="border-color: var(--red-holcim); color: var(--red-holcim); font-weight: 900;">
                            <i class="fas fa-sign-out-alt"></i> <span data-i18n="logout">CERRAR SESIóN</span>
                        </button>
                    </div>
                </aside>

                <main class="settings-content-card">
                    <!-- Profile Section -->
                    <div id="settings-profile" class="settings-section active">
                        <h2 style="margin-bottom: 2rem;" data-i18n="settings_profile_title">Configuración de Perfil</h2>
                        <form id="my-profile-form">
                            <div class="form-group">
                                <label class="form-label" data-i18n="settings_profile_site">Mi Perfil de Sitio</label>
                                <input type="text" id="my-site" placeholder="Ej: Planta Cartago..." required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="settings_profile_pass">Nueva Contraseña</label>
                                <input type="password" id="my-new-pass" placeholder="Dejar vacío para no cambiar">
                            </div>
                            <button type="submit" class="btn-submit-action"
                                style="background: var(--primary-teal); max-width: 300px;">
                                <span data-i18n="settings_profile_btn">ACTUALIZAR DATOS</span>
                            </button>
                        </form>
                    </div>

                    <!-- User Management Section -->
                    <div id="settings-users" class="settings-section">
                        <h2 style="margin-bottom: 2rem;" data-i18n="settings_users_title">Gestión de Cuentas</h2>
                        <div class="dashboard-grid" style="grid-template-columns: 350px 1fr; gap: 2rem;">
                            <form id="user-form">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="user-email" placeholder="usuario@gmail.com" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Password</label>
                                    <input type="password" id="user-pass" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Sitio</label>
                                    <input type="text" id="user-site" required>
                                </div>
                                <div class="premium-permission-grid"
                                    style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 1rem;">
                                    <label class="perm-chip"><input type="checkbox" name="perm" value="dashboard"
                                            checked><span>Acceso</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="reports"><span>Reportes</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="cctv-monitoring"><span>Monitoreo</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="database"><span>Base Datos</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="extra-auth"><span>Extra Aut.</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="keys"><span>Llaves</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="inductions"><span>Inducciones</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="settings"><span>Config.</span></label>
                                </div>
                                <button type="submit" class="btn-submit-action" style="margin-top: 1.5rem;">CREAR
                                    USUARIO</button>
                            </form>
                            <div>
                                <div class="monitor-list" id="user-list-body"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Local Storage Section -->
                    <div id="settings-storage" class="settings-section">
                        <h2 style="margin-bottom: 1rem;" data-i18n="settings_storage_title">Almacenamiento Local</h2>
                        <p style="color: var(--text-muted); margin-bottom: 2rem;" data-i18n="settings_storage_subtitle">
                            Configure una carpeta en su computadora para guardar copias de seguridad automÁticas de
                            todos los registros.
                        </p>

                        <div id="btn-select-folder" class="btn-folder-select">
                            <i class="fas fa-folder-open"></i>
                            <span style="font-weight: 800;" data-i18n="settings_storage_select_btn">SELECCIONAR CARPETA
                                DE DESTINO</span>
                            <div id="selected-folder-path" class="folder-path-display" style="display: none;"></div>
                        </div>

                        <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                            <button class="btn-submit-action" style="background: var(--primary-green); flex: 1;"
                                onclick="triggerManualBackup()">
                                <i class="fas fa-cloud-download-alt"></i> <span
                                    data-i18n="settings_storage_backup_btn">RESPALDAR TODO AHORA</span>
                            </button>
                            <button class="btn-submit-action" style="background: var(--navy-black); flex: 1;"
                                onclick="testFolderAccess()">
                                <i class="fas fa-shield-alt"></i> <span data-i18n="settings_storage_test_btn">PROBAR
                                    CONEXIÓN</span>
                            </button>
                        </div>
                        <div id="storage-drive-tip"
                            style="margin-top: 1.5rem; padding: 15px; background: rgba(0, 156, 189, 0.05); border: 1px dashed var(--primary-teal); border-radius: 8px; display: none;">
                            <div
                                style="display: flex; align-items: center; gap: 12px; color: var(--primary-teal); font-weight: 700; font-size: 0.8rem;">
                                <i class="fab fa-google-drive" style="font-size: 1.2rem;"></i>
                                <span>Sugerencia: Para respaldo en la nube, seleccione una carpeta sincronizada con
                                    Google Drive para Escritorio.</span>
                            </div>
                        </div>
                    </div>

                    <!-- Live Log Section -->
                    <div id="settings-logs" class="settings-section">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 data-i18n="settings_logs_title">Bitácora en Vivo</h2>
                            <button class="btn-export" onclick="exportEventLog()">
                                <i class="fas fa-file-export"></i> EXPORTAR
                            </button>
                        </div>
                        <div class="monitor-list" style="max-height: 500px; overflow-y: auto;" id="live-log-container">
                            <div class="list-head" style="grid-template-columns: 140px 100px 100px 1fr;">
                                <span>Fecha / Hora</span>
                                <span>Usuario</span>
                                <span>Módulo</span>
                                <span>Descripción del Evento</span>
                            </div>
                            <div id="live-event-log">
                                <div style="padding: 2rem; text-align: center; color: var(--text-muted);">Iniciando
                                    Bitácora de eventos...</div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- ===================== CALENDAR ===================== -->
        <div id="calendar-view" class="view-section calendar-view" style="display: none;">
            <div class="calendar-header" style="padding: 1rem 1.5rem; margin-bottom: 1rem;">
                <div>
                    <h2 style="font-size: 1.5rem; font-weight: 900; text-transform: uppercase; margin-bottom: 0;">
                        Calendario de Eventos</h2>
                </div>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <button class="btn-submit-action" onclick="changeMonth(-1)"
                        style="padding: 5px 12px; background: rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); width: auto; height: auto; margin-top: 0;"><i
                            class="fas fa-chevron-left"></i></button>
                    <h3 id="calendar-month-year"
                        style="margin: 0; min-width: 150px; text-align: center; color: var(--navy-black); border: none; padding: 0; font-size: 1.2rem; font-weight: 900; letter-spacing: -0.5px;">
                        Mes aÑo</h3>
                    <button class="btn-submit-action" onclick="changeMonth(1)"
                        style="padding: 5px 12px; background: rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); width: auto; height: auto; margin-top: 0;"><i
                            class="fas fa-chevron-right"></i></button>
                </div>
            </div>

            <div class="calendar-container" style="border-radius: 12px; overflow: hidden;">
                <div class="calendar-grid-header" style="padding: 10px 0; font-size: 0.7rem;">
                    <span>LUN</span><span>MAR</span><span>MIÉ</span><span>JUE</span><span>VIE</span><span>SÁB</span><span>DOM</span>
                </div>
                <div id="calendar-grid" class="calendar-grid">
                    <!-- Day cells injected by JS -->
                </div>
            </div>
        </div>

    </main>

    <!-- Modal Contractor Consolidation -->
    <div id="modal-contractor-hours" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Consolidado Mensual de Contratistas</h3>
                <button class="btn-close-modal" onclick="closeContractorModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="report-meta">
                    <span id="contractor-report-month">---</span>
                    <button class="btn-export" onclick="exportConsolidated()"
                        style="font-size: 0.7rem; padding: 5px 10px;">
                        <i class="fas fa-file-download"></i> Descargar CSV
                    </button>
                </div>
                <div class="monitor-list" style="max-height: 400px; overflow-y: auto;">
                    <div id="contractor-consolidated-body"><!-- Data rows --></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Overtime Alerts -->
    <div id="modal-security-alerts" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 600px;">
            <div class="modal-header" style="background: var(--red-holcim); color: white;">
                <h3 style="color: white;"><i class="fas fa-exclamation-triangle"></i> Personas con Tiempo Excedido
                    (&gt;12h)</h3>
                <button class="btn-close-modal" onclick="closeAlertsModal()" style="color: white;">&times;</button>
            </div>
            <div class="modal-body">
                <div id="alerts-list-body" class="monitor-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Alert rows -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Entry Modal -->
    <div id="modal-edit-entry" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Registro</h3>
                <button class="btn-close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-entry-id">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Nombre Completo</label>
                    <input type="text" id="edit-fullname">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Empresa</label>
                    <input type="text" id="edit-company">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Gafete</label>
                    <select id="edit-badge">
                        <option value="">Seleccione Gafete...</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Departamento</label>
                    <input type="text" id="edit-department">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Responsable Holcim</label>
                    <input type="text" id="edit-responsible">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Placa de Vehículo</label>
                    <input type="text" id="edit-plate">
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label class="form-label">Motivo</label>
                    <input type="text" id="edit-reason">
                </div>
                <button class="btn-submit-action" onclick="saveEntryEdit()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>

    <!-- Traceability / Audit Log Modal -->
    <div id="modal-traceability" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 700px;">
            <div class="modal-header" style="background: var(--navy-black); color: white;">
                <h3 style="color: white;"><i class="fas fa-history"></i> Historial de Trazabilidad de Registro</h3>
                <button class="btn-close-modal" onclick="closeTraceabilityModal()"
                    style="color: white;">&times;</button>
            </div>
            <div class="modal-body">
                <div class="audit-meta"
                    style="margin-bottom: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <span id="trace-record-id" style="font-weight: 700; font-size: 0.8rem;">ID: ---</span>
                        <span id="trace-record-name"
                            style="font-weight: 700; font-size: 0.8rem; text-align: right;">Personal: ---</span>
                    </div>
                </div>
                <div class="monitor-list" style="max-height: 400px; overflow-y: auto;">
                    <div class="list-head" style="grid-template-columns: 140px 140px 100px 1fr 1fr;">
                        <span>Fecha / Hora</span>
                        <span>Usuario</span>
                        <span>Campo</span>
                        <span>Valor Anterior</span>
                        <span>Valor Nuevo</span>
                    </div>
                    <div id="traceability-list-body"><!-- Audit rows --></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Auth Modal -->
    <div id="modal-edit-auth" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Autorización</h3>
                <button class="btn-close-modal" onclick="closeEditAuthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-auth-id">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Beneficiario</label>
                    <input type="text" id="edit-auth-name">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Empresa</label>
                    <input type="text" id="edit-auth-company">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Autoriza</label>
                    <input type="text" id="edit-auth-approver">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="form-group">
                        <label class="form-label">Inicio</label>
                        <input type="date" id="edit-auth-start">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Expira</label>
                        <input type="date" id="edit-auth-end">
                    </div>
                </div>
                <button class="btn-submit-action" onclick="saveAuthEdit()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>

    <!-- Edit Key Loan Modal -->
    <div id="modal-edit-key-loan" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Préstamo de Llave</h3>
                <button class="btn-close-modal" onclick="closeEditKeyModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-key-loan-id">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Solicitante</label>
                    <input type="text" id="edit-key-requestor">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Oficial entrega</label>
                    <input type="text" id="edit-key-officer">
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label class="form-label">Número Llave</label>
                    <input type="number" id="edit-key-num">
                </div>
                <button class="btn-submit-action" onclick="saveKeyLoanEdit()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>


    <!-- Event Modal -->
    <div id="modal-calendar-event" class="modal-overlay">
        <div class="modal-content" style="max-width: 450px;">
            <div class="panel-header"
                style="background: var(--primary-teal); display: flex; justify-content: space-between; align-items: center;">
                <h3 style="color: white; margin: 0;"><i class="fas fa-calendar-plus"></i> Gestionar Evento</h3>
                <button onclick="closeEventModal()"
                    style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="panel-body">
                <form id="event-form">
                    <input type="hidden" id="event-date">
                    <div class="form-group">
                        <label class="form-label" id="event-date-display"
                            style="font-weight: 800; color: var(--navy-black);"></label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Título del Evento / Nota</label>
                        <input type="text" id="event-title" placeholder="Ej: Mantimiento Proyectores" required>
                    </div>
                    <div class="form-group"><label class="form-label">Hora del Evento</label><input type="time"
                            id="event-time" value="09:00"
                            style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripción Detallada</label>
                        <textarea id="event-desc" style="width: 100%; height: 80px; resize: none;"
                            placeholder="Detalles del evento..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Color de Etiqueta</label>
                        <div style="display: flex; gap: 15px; margin-top: 5px;">
                            <label style="cursor:pointer;"><input type="radio" name="event-color"
                                    value="var(--primary-teal)" checked style="display:none;"> <span
                                    class="color-picker-dot"
                                    style="display:inline-block; width:24px; height:24px; background:var(--primary-teal); border-radius:50%; border: 2px solid white; box-shadow: 0 0 0 1px #ddd;"></span></label>
                            <label style="cursor:pointer;"><input type="radio" name="event-color"
                                    value="var(--primary-green)" style="display:none;"> <span class="color-picker-dot"
                                    style="display:inline-block; width:24px; height:24px; background:var(--primary-green); border-radius:50%; border: 2px solid white; box-shadow: 0 0 0 1px #ddd;"></span></label>
                            <label style="cursor:pointer;"><input type="radio" name="event-color"
                                    value="var(--red-holcim)" style="display:none;"> <span class="color-picker-dot"
                                    style="display:inline-block; width:24px; height:24px; background:var(--red-holcim); border-radius:50%; border: 2px solid white; box-shadow: 0 0 0 1px #ddd;"></span></label>
                            <label style="cursor:pointer;"><input type="radio" name="event-color" value="#f59e0b"
                                    style="display:none;"> <span class="color-picker-dot"
                                    style="display:inline-block; width:24px; height:24px; background:#f59e0b; border-radius:50%; border: 2px solid white; box-shadow: 0 0 0 1px #ddd;"></span></label>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
                        <button type="button" onclick="deleteEvent()" id="btn-delete-event" class="btn-salida-corpo"
                            style="background: #ef4444; border-color: #ef4444; flex: 1; display: none;">ELIMINAR</button>
                        <button type="submit" class="btn-submit-action" style="flex: 2;">GUARDAR EVENTO</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Package Modal -->
    <div id="modal-edit-package" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Paquete</h3>
                <button class="btn-close-modal" onclick="closeEditPackageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-package-id">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">MensajerÍa / Courier</label>
                    <input type="text" id="edit-pkg-courier">
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label class="form-label">Destinatario</label>
                    <input type="text" id="edit-pkg-recipient">
                </div>
                <button class="btn-submit-action" onclick="savePackageEdit()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>

    <!-- Scanner Modal -->
    <div id="modal-scanner" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px; padding: 1.5rem;">
            <div class="modal-header"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="margin: 0;"><i class="fas fa-camera" style="color: var(--primary-teal);"></i> Escanear Cédula
                </h3>
                <button onclick="closeScanner()"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
            </div>
            <div id="reader" style="width: 100%; border-radius: 8px; overflow: hidden; background: #000;"></div>
            <p style="text-align: center; color: var(--text-muted); font-size: 0.8rem; margin-top: 1rem;">Enfoque el
                Código QR o Código de barras de la CÉdula.</p>
            <button onclick="closeScanner()" class="btn-salida-corpo"
                style="margin-top: 1rem; width: 100%;">CANCELAR</button>
        </div>
    </div>

    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="main.js"></script>
    <script src="packages.js"></script>
    <datalist id="officers-list"><!-- Populated by JS --></datalist>
    <!-- Emergency Directory Modal -->
    <div id="modal-emergency-dir" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <div class="panel-header"
                style="background: #e11d48; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="color: white; margin: 0;"><i class="fas fa-phone-alt"></i> Directorio de Planta</h3>
                <button onclick="closeEmergencyDirectory()"
                    style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="panel-body">
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <div style="position: relative;">
                        <i class="fas fa-search"
                            style="position: absolute; left: 15px; top: 12px; color: var(--text-muted);"></i>
                        <input type="text" id="emergency-dir-search" placeholder="Buscar por nombre o departamento..."
                            style="padding-left: 45px; height: 45px;">
                    </div>
                </div>
                <div class="monitor-list" style="max-height: 400px; overflow-y: auto;">
                    <div class="list-head" style="grid-template-columns: 1fr 120px 120px 100px;">
                        <span>Nombre / Cargo</span>
                        <span>Dpto</span>
                        <span>Teléfono</span>
                        <span>Radio</span>
                    </div>
                    <div id="emergency-dir-body"><!-- Dynamic dynamic rows --></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Safety Event Report Modal -->
    <div id="modal-safety-report" class="modal-overlay" style="display: none;">
        <div class="modal-content"
            style="max-width: 600px; max-height: 95vh; display: flex; flex-direction: column; overflow: hidden; border-radius: 12px;">
            <div class="panel-header"
                style="background: var(--navy-black); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                <h3 style="color: white; margin: 0;"><i class="fas fa-file-shield"></i> Reporte de Evento de Seguridad
                </h3>
                <button onclick="closeSafetyReportModal()"
                    style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="panel-body" style="overflow-y: auto; flex-grow: 1; padding: 1.5rem;">
                <form id="safety-report-form">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Fecha del Evento</label>
                            <input type="date" id="sr-date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Hora del Evento</label>
                            <input type="time" id="sr-time" required>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Nombre del Oficial / Reportante</label>
                            <input type="text" id="sr-officer" placeholder="Nombre completo..." required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tipo de Incidente</label>
                            <input type="text" id="sr-type" placeholder="Ej: Intrusión, Robo, Falla..." required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Área o Sector Vinculado (Texto Abierto)</label>
                        <input type="text" id="sr-area" placeholder="Especifique el área exacta..." required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Personas Involucradas</label>
                        <input type="text" id="sr-people" placeholder="Nombres, cargos o ID si aplica...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Detalle del Evento / Incidente</label>
                        <textarea id="sr-detail" style="width: 100%; height: 100px; resize: none;"
                            placeholder="Describa los hechos de forma clara..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Acciones Tomadas</label>
                        <textarea id="sr-actions" style="width: 100%; height: 80px; resize: none;"
                            placeholder="¿Qué medidas se aplicaron inmediatamente?"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Adjuntar Evidencia Fotográfica</label>
                        <input type="file" id="sr-photo" accept="image/*" onchange="previewSafetyImage(event)">
                        <div id="sr-photo-preview" style="margin-top: 10px; display: none; text-align: center;">
                            <img id="sr-preview-img"
                                style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #ddd;">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 2rem;">
                        <button type="button" onclick="closeSafetyReportModal()" class="btn-salida-corpo"
                            style="flex: 1;">CANCELAR</button>
                        <button type="button" onclick="downloadSafetyReportPDF()" class="btn-submit-action"
                            style="flex: 1; background: var(--primary-teal);">
                            <i class="fas fa-file-pdf"></i> GENERAR REPORTE AZUL
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Personnel Detail Modal (Dashboard Drill-down) -->
    <div id="modal-personnel-detail" class="modal-overlay">
        <div class="modal-content" style="max-width: 900px;">
            <div class="panel-header" id="personnel-detail-header"
                style="background: var(--navy-black); display: flex; justify-content: space-between; align-items: center;">
                <h3 id="personnel-detail-title" style="color: white; margin: 0;">Personal en Planta</h3>
                <button onclick="closePersonnelDetail()"
                    style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="panel-body">
                <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                    <div class="list-head" style="grid-template-columns: 120px 1fr 150px 140px 140px;">
                        <span>Cédula</span>
                        <span>Nombre Completo</span>
                        <span>Empresa</span>
                        <span>Departamento</span>
                        <span>Hora Ingreso</span>
                    </div>
                    <div id="personnel-detail-body"><!-- Dynamic rows --></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Map Picker Modal -->
    <div id="modal-map-picker" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 800px; padding: 0; overflow: hidden; border-radius: 12px;">
            <div class="modal-header" style="background: var(--navy-black); padding: 1rem 2rem;">
                <h3 style="color: white; margin: 0;"><i class="fas fa-map-location-dot"></i> Seleccionar Ubicación</h3>
                <button class="btn-close-modal" onclick="closeMapPicker()" style="color: white;">&times;</button>
            </div>
            <div id="picker-map" style="height: 500px; width: 100%; min-width: 300px;"></div>
            <div
                style="padding: 1rem 2rem; background: #f8fafc; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--border-gray);">
                <p style="font-size: 0.8rem; color: var(--text-muted); margin: 0;">Haga clic en el mapa para marcar la
                    UBICACIóN exacta.</p>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span id="picker-coords-display"
                        style="font-family: monospace; font-size: 0.9rem; font-weight: 700; color: var(--primary-teal);">[
                        - , - ]</span>
                    <button class="btn-crear" onclick="confirmMapPickerSelection()"
                        style="padding: 5px 15px; margin: 0; width: auto;">CONFIRMAR</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>