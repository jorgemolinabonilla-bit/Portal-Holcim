<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holcim Group | Portal de Seguridad</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        @keyframes pulse-red {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(237, 28, 22, 0.4);
            }

            70% {
                transform: scale(1.1);
                box-shadow: 0 0 0 10px rgba(237, 28, 22, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(237, 28, 22, 0);
            }
        }

        .pulse-active {
            animation: pulse-red 1.5s infinite;
            color: var(--red-holcim) !important;
        }
    </style>
</head>

<body>
    <header class="header-top">
        <div class="logo-section">
            <div class="holcim-logo-icon"></div>
            <div class="holcim-logo-text">HOLCIM</div>
            <div id="header-site-name"
                style="margin-left: 1rem; padding-left: 1rem; border-left: 1px solid var(--border-gray); color: var(--text-muted); font-size: 0.75rem; font-weight: 600; text-transform: uppercase;">
                CONTROL DE ACCESO
            </div>
        </div>

        <div class="search-mockup">
            <i class="fas fa-search" style="color: var(--text-muted);"></i>
            <input type="text" placeholder="Buscar personal, documentos, reportes..." readonly>
        </div>

        <div class="header-actions">
            <div class="clock-display" id="digital-clock">00:00:00</div>
            <div class="user-profile">J</div>
            <button class="btn-logout-header" id="btn-logout-header" title="Cerrar Sesión">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </header>

    <nav class="nav-bar">
        <ul class="nav-links">
            <li><a href="#" class="nav-link active" data-view="dashboard"><i class="fas fa-id-card"></i> Control de
                    Acceso</a></li>
            <li><a href="#" class="nav-link" data-view="extra-auth"><i class="fas fa-user-check"></i> Autorizaciones
                    Extraordinarias</a></li>
            <li><a href="#" class="nav-link" data-view="keys"><i class="fas fa-key"></i> Control de Llaves</a></li>
            <li><a href="#" class="nav-link" data-view="packages"><i class="fas fa-box-open"></i> Gestión de
                    Paquetería</a></li>
            <li><a href="#" class="nav-link" data-view="forms"><i class="fas fa-file-signature"></i> Formularios de
                    Reportes</a></li>
            <li><a href="#" class="nav-link" data-view="database"><i class="fas fa-database"></i> Base de Datos</a></li>
            <li><a href="#" class="nav-link" data-view="settings"><i class="fas fa-cog"></i> Configuración</a></li>
        </ul>
    </nav>

    <!-- Login System -->
    <div id="login-overlay">
        <div class="login-card">
            <div class="holcim-logo-icon"></div>
            <h2 style="color: var(--navy-black); margin-bottom: 0.5rem; font-weight: 900;">PORTAL DE SEGURIDAD</h2>
            <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 2rem;">Inicie sesión para continuar
            </p>
            <form id="login-form">
                <div class="form-group" style="text-align: left;">
                    <label class="form-label">Correo Electrónico</label>
                    <input type="email" id="login-email" placeholder="ejemplo@holcim.com" required>
                </div>
                <div class="form-group" style="text-align: left; margin-top: 1rem;">
                    <label class="form-label">Contraseña</label>
                    <input type="password" id="login-pass" placeholder="••••••••" required>
                </div>
                <button type="submit" class="btn-submit-action" style="margin-top: 2rem;">RECONOCER IDENTIDAD</button>
            </form>
        </div>
    </div>

    <main class="main-wrapper">

        <!-- ===================== DASHBOARD / ACCESS CONTROL ===================== -->
        <div id="dashboard-view" class="view-section">
            <div class="dashboard-grid">
                <aside class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-user-plus" style="color: var(--primary-teal);"></i> Registro de Ingreso
                        </h3>
                    </div>
                    <div class="panel-body">
                        <form id="access-form">
                            <div class="form-group">
                                <label class="form-label">Número de Cédula</label>
                                <div style="position: relative;">
                                    <input type="text" id="idNumber" placeholder="0-0000-0000" autocomplete="off"
                                        required style="padding-right: 3rem;">
                                    <button type="button" id="btn-scan-id" title="Escanear Código QR/Barras"
                                        style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--primary-teal); cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 4px; transition: background 0.2s;">
                                        <i class="fas fa-qrcode"></i>
                                    </button>
                                    <div id="lookup-indicator"
                                        style="position: absolute; right: 5.5rem; top: 50%; transform: translateY(-50%);">
                                    </div>
                                    <button type="button" id="btn-voice-id" title="Dictar Cédula por Voz"
                                        style="position: absolute; right: 2.8rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 4px; transition: all 0.2s;">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                </div>
                                <div id="induction-alert-box"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Inducción de Seguridad</label>
                                <div class="induction-checkbox">
                                    <input type="checkbox" id="inductionPassed">
                                    <label for="inductionPassed">Registrar inducción realizada hoy</label>
                                </div>
                                <p style="font-size: 0.6rem; color: var(--text-muted); margin-top: 4px;">* Válida por 1
                                    año calendario.</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Categoría</label>
                                <select id="visitorType" required>
                                    <option value="" disabled selected>Seleccione tipo...</option>
                                    <option value="VISITANTE">VISITANTE</option>
                                    <option value="PROVEEDOR">PROVEEDOR</option>
                                    <option value="CONTRATISTA">CONTRATISTA</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nombre Completo</label>
                                <input type="text" id="fullName" placeholder="Validación automática Hacienda/TSE"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Empresa / Contratista</label>
                                <input type="text" id="company" placeholder="Nombre de la empresa" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ubicación / Departamento</label>
                                <select id="department" required>
                                    <option value="" disabled selected>Seleccione Departamento</option>
                                    <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                    <option value="PRODUCCION">PRODUCCION</option>
                                    <option value="CALIDAD">CALIDAD</option>
                                    <option value="ADMINISTRACION">ADMINISTRACION</option>
                                    <option value="H&S">H&S / SALUD Y SEGURIDAD</option>
                                    <option value="PROYECTOS">PROYECTOS</option>
                                    <option value="GEOCYCLE">GEOCYCLE</option>
                                    <option value="LOGISTICA">LOGISTICA</option>
                                    <option value="ALMACEN">ALMACEN</option>
                                    <option value="AMBIENTE">AMBIENTE</option>
                                    <option value="COMUNICACION">COMUNICACION</option>
                                    <option value="CEPAL">CEPAL</option>
                                    <option value="PROVEEDURIA">PROVEEDURIA</option>
                                    <option value="TI">TI / TECNOLOGIA</option>
                                    <option value="CETEC">CETEC</option>
                                    <option value="MINERIA">MINERIA</option>
                                    <option value="SERVICIOS GENERALES">SERVICIOS GENERALES</option>
                                    <option value="OTROS">OTROS</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Responsable Holcim</label>
                                <input type="text" id="responsible" placeholder="Persona que autoriza / visita"
                                    required>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Motivo</label>
                                    <select id="reason" required>
                                        <option value="" disabled selected>Seleccione motivo</option>
                                        <option value="REUNION">REUNION</option>
                                        <option value="ENTREGA">ENTREGA</option>
                                        <option value="PASANTIA">PASANTIA</option>
                                        <option value="TRABAJAR">TRABAJAR</option>
                                        <option value="AUDITORIA">AUDITORIA</option>
                                        <option value="OTROS">OTROS</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Placa Vehículo</label>
                                    <input type="text" id="vehiclePlate" placeholder="ABC-123">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Gafete Asignado</label>
                                <input type="text" id="badgeNumber" placeholder="G0000" required>
                            </div>

                            <button type="submit" class="btn-submit-action">REGISTRAR ENTRADA</button>
                        </form>
                    </div>
                </aside>

                <!-- Right: Monitor -->
                <section class="monitor-view">
                    <div class="summary-cards"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="card-stat primary" onclick="showFilteredPersonnel('ALL')" style="cursor:pointer">
                            <div class="stat-content">
                                <h4>Total en Planta</h4>
                                <div class="stat-value" id="count-active">0</div>
                            </div>
                            <i class="fas fa-users stat-icon" style="color: var(--primary-teal);"></i>
                        </div>
                        <div class="card-stat" onclick="showFilteredPersonnel('CONTRATISTA')"
                            style="border-top: 4px solid #10B981; background: #ECFDF5; cursor:pointer">
                            <div class="stat-content">
                                <h4 style="color: #065F46;">Contratistas</h4>
                                <div class="stat-value" id="count-contractors" style="color: #047857;">0</div>
                            </div>
                            <i class="fas fa-hard-hat stat-icon" style="color: #10B981; opacity:0.2"></i>
                        </div>
                        <div class="card-stat" onclick="showFilteredPersonnel('VISITANTE')"
                            style="border-top: 4px solid #F59E0B; background: #FFFBEB; cursor:pointer">
                            <div class="stat-content">
                                <h4 style="color: #92400E;">Visitas</h4>
                                <div class="stat-value" id="count-visitors" style="color: #B45309;">0</div>
                            </div>
                            <i class="fas fa-user-tie stat-icon" style="color: #F59E0B; opacity:0.2"></i>
                        </div>
                        <div class="card-stat" onclick="showFilteredPersonnel('PROVEEDOR')" style="cursor:pointer">
                            <div class="stat-content">
                                <h4>Proveedores</h4>
                                <div class="stat-value" id="count-providers" style="color: var(--navy-black);">0</div>
                            </div>
                            <i class="fas fa-truck-loading stat-icon" style="color: var(--text-muted); opacity:0.3"></i>
                        </div>
                        <div class="card-stat alert" id="btn-show-alerts" onclick="showOvertimeAlerts()">
                            <div class="stat-content">
                                <h4>Alertas (+12h)</h4>
                                <div class="stat-value red-text" id="count-alerts">0</div>
                            </div>
                            <i class="fas fa-exclamation-triangle stat-icon" style="color: var(--red-holcim);"></i>
                        </div>
                    </div>

                    <div class="card-panel">
                        <div class="panel-header"
                            style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <h3><i class="fas fa-desktop" style="color: var(--primary-teal);"></i> Monitoreo en Vivo
                            </h3>

                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="btn-export" onclick="switchView('reports')"
                                    style="background: var(--navy-black); padding: 5px 12px; font-size: 0.75rem;"><i
                                        class="fas fa-file-invoice"></i> Reportes</button>
                                <button class="btn-export" onclick="switchView('inductions')"
                                    style="background: var(--primary-teal); padding: 5px 12px; font-size: 0.75rem;"><i
                                        class="fas fa-clipboard-check"></i> Inducciones</button>
                                <button class="btn-export" onclick="openEmergencyDirectory()"
                                    style="background: #e11d48; padding: 5px 12px; font-size: 0.75rem;"><i
                                        class="fas fa-phone-alt"></i> Directorio</button>

                                <div style="width: 1px; height: 20px; background: #ddd; margin: 0 5px;"></div>

                                <div style="position: relative; width: 200px;">
                                    <i class="fas fa-search"
                                        style="position: absolute; left: 0.8rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 0.75rem;"></i>
                                    <input type="text" id="monitor-search" placeholder="Buscar..."
                                        style="padding-left: 2rem; height: 32px; font-size: 0.8rem; border-radius: 4px; border: 1px solid var(--border-gray); width: 100%;">
                                </div>

                                <select id="filter-monitor-category"
                                    style="height: 32px; font-size: 0.75rem; border-radius: 4px; border: 1px solid var(--border-gray); font-weight: 600;">
                                    <option value="ALL">TODAS LAS CATEGORÍAS</option>
                                    <option value="VISITANTE">VISITANTES</option>
                                    <option value="PROVEEDOR">PROVEEDORES</option>
                                    <option value="CONTRATISTA">CONTRATISTAS</option>
                                </select>

                                <div class="export-actions">
                                    <button class="btn-export" onclick="exportMonitor('xlsx')" title="Exportar Excel"><i
                                            class="fas fa-file-excel"></i></button>
                                    <button class="btn-export" style="background: var(--red-holcim);"
                                        onclick="window.print()" title="Imprimir PDF"><i
                                            class="fas fa-file-pdf"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="card-panel" style="margin-top: 1rem;">
                            <div class="monitor-list">
                                <div class="list-head"
                                    style="grid-template-columns: 80px 1fr 80px 130px 130px 100px 120px 100px;">
                                    <span>Gafete</span>
                                    <span>Visitante / Empresa</span>
                                    <span style="font-size: 0.75rem;">Placa</span>
                                    <span>Departamento</span>
                                    <span>Responsable</span>
                                    <span>Motivo</span>
                                    <span>Ingreso</span>
                                    <span>Acción</span>
                                </div>
                                <div id="monitor-list-body"><!-- Dynamic rows --></div>
                                <div id="empty-state"
                                    style="padding: 5rem; text-align: center; color: var(--text-muted);">
                                    <i class="fas fa-user-clock fa-3x" style="margin-bottom: 1.5rem; opacity: 0.1;"></i>
                                    <p style="font-size: 0.85rem; font-weight: 600;">No hay personal registrado en
                                        planta actualmente.</p>
                                </div>
                            </div>
                        </div>
                </section>
            </div>
        </div>

        <!-- ===================== REPORTS ===================== -->
        <div id="reports-view" class="view-section" style="display: none;">
            <div class="card-panel">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-file-invoice" style="color: var(--primary-teal);"></i> Histórico y Reportes de
                        Planta</h3>
                    <div class="export-actions">
                        <button class="btn-export" style="background: var(--primary-teal);"
                            onclick="renderMonthlyContractorConsolidated()"><i class="fas fa-calculator"></i>
                            Consolidado Contratistas</button>
                        <button class="btn-export" onclick="exportData('xlsx')"><i class="fas fa-file-excel"></i>
                            Excel</button>
                        <button class="btn-export" style="background: var(--red-holcim);" onclick="printReport()"><i
                                class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="filter-bar">
                    <div class="filter-group">
                        <label>Desde / Hasta</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="date" id="filter-date-start">
                            <input type="date" id="filter-date-end">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Búsqueda General</label>
                        <input type="text" id="report-search" placeholder="Nombre, Cédula, Empresa...">
                    </div>
                    <div class="filter-group">
                        <label>Tipo de Visitante</label>
                        <select id="filter-visitor-type">
                            <option value="ALL">TODOS</option>
                            <option value="VISITANTE">VISITANTE</option>
                            <option value="PROVEEDOR">PROVEEDOR</option>
                            <option value="CONTRATISTA">CONTRATISTA</option>
                        </select>
                    </div>
                </div>
                <div class="monitor-list">
                    <div class="list-head" style="grid-template-columns: 140px 1fr 140px 140px 110px 110px 130px;">
                        <span>Fecha / ID</span>
                        <span>Personal</span>
                        <span>Empresa</span>
                        <span>Responsable</span>
                        <span>Entrada</span>
                        <span>Salida</span>
                        <span>Estado</span>
                    </div>
                    <div id="report-list-body"><!-- History rows --></div>
                </div>
            </div>
        </div>

        <!-- ===================== INDUCTIONS ===================== -->
        <div id="inductions-view" class="view-section" style="display: none;">
            <div class="card-panel">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-shield-alt" style="color: var(--primary-teal);"></i> Base de Datos de
                        Inducciones</h3>
                    <div class="export-actions">
                        <button class="btn-export" onclick="exportInductions('xlsx')"><i class="fas fa-file-excel"></i>
                            Excel</button>
                        <button class="btn-export" style="background: var(--red-holcim);" onclick="window.print()"><i
                                class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="filter-bar" style="grid-template-columns: 1fr 1fr 200px;">
                    <div class="filter-group">
                        <label>Búsqueda Personal</label>
                        <input type="text" id="induction-search" placeholder="Cédula, Nombre o Empresa...">
                    </div>
                    <div class="filter-group">
                        <label>Fecha de Inducción (Rango)</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="date" id="ind-date-start">
                            <input type="date" id="ind-date-end">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Estado de Vigencia</label>
                        <select id="filter-ind-status">
                            <option value="ALL">TODOS</option>
                            <option value="valid">VIGENTE</option>
                            <option value="expired">VENCIDA</option>
                        </select>
                    </div>
                </div>
                <div class="monitor-list">
                    <div class="list-head" style="grid-template-columns: 120px 1fr 150px 150px 130px;">
                        <span>Cédula</span>
                        <span>Nombre Completo</span>
                        <span>Empresa</span>
                        <span>Última Inducción</span>
                        <span>Vigencia</span>
                    </div>
                    <div id="induction-list-body"><!-- Induction database rows --></div>
                </div>
            </div>
        </div>

        <!-- ===================== EXTRA AUTH ===================== -->
        <div id="extra-auth-view" class="view-section" style="display: none;">
            <div class="dashboard-grid" style="grid-template-columns: 380px 1fr;">
                <aside class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-file-contract" style="color: var(--primary-teal);"></i> Nueva Autorización
                        </h3>
                    </div>
                    <div class="panel-body">
                        <form id="auth-form">
                            <div class="form-group">
                                <label class="form-label">Nombre del Beneficiario</label>
                                <input type="text" id="auth-name" placeholder="Nombre completo" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Empresa</label>
                                <input type="text" id="auth-company" placeholder="Empresa externa / Contratista"
                                    required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Persona que Autoriza</label>
                                <input type="text" id="auth-approver" placeholder="Nombre del responsable Holcim"
                                    required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Fecha Emisión</label>
                                    <input type="date" id="auth-date-start" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Fecha Expiración</label>
                                    <input type="date" id="auth-date-end" required>
                                </div>
                            </div>
                            <button type="submit" class="btn-submit-action">GUARDAR AUTORIZACIÓN</button>
                        </form>
                    </div>
                </aside>
                <section class="monitor-view">
                    <div class="card-panel">
                        <div class="panel-header"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <h3><i class="fas fa-database" style="color: var(--primary-teal);"></i> Base de Datos de
                                Autorizaciones</h3>
                            <div class="export-actions">
                                <button class="btn-export" onclick="exportAuth('xlsx')"><i
                                        class="fas fa-file-excel"></i> Excel</button>
                                <button class="btn-export" style="background: var(--red-holcim);"
                                    onclick="window.print()"><i class="fas fa-file-pdf"></i> PDF</button>
                            </div>
                        </div>
                        <div class="filter-bar" style="grid-template-columns: 1fr 1fr 120px 120px;">
                            <div class="filter-group">
                                <label>Persona</label>
                                <input type="text" id="auth-search-name" placeholder="Nombre...">
                            </div>
                            <div class="filter-group">
                                <label>Empresa</label>
                                <input type="text" id="auth-search-company" placeholder="Empresa...">
                            </div>
                            <div class="filter-group">
                                <label>Estado</label>
                                <select id="auth-filter-status">
                                    <option value="ALL">TODOS</option>
                                    <option value="VIGENTE">VIGENTE</option>
                                    <option value="POR VENCER">POR VENCER</option>
                                    <option value="VENCIDA">VENCIDA</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Filtrar por Mes</label>
                                <input type="month" id="auth-filter-date">
                            </div>
                        </div>
                        <div class="monitor-list">
                            <div class="list-head" style="grid-template-columns: 1fr 150px 140px 110px 110px 100px;">
                                <span>Persona</span>
                                <span>Empresa</span>
                                <span>Autoriza</span>
                                <span>Emisión</span>
                                <span>Expira</span>
                                <span>Estado</span>
                            </div>
                            <div id="auth-list-body"><!-- Auth rows --></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- ===================== KEYS ===================== -->
        <div id="keys-view" class="view-section" style="display: none;">
            <div class="dashboard-grid" style="grid-template-columns: 380px 1fr;">
                <aside class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-key" style="color: var(--primary-teal);"></i> Registro de Préstamo</h3>
                    </div>
                    <div class="panel-body">
                        <form id="key-loan-form">
                            <div class="form-group">
                                <label class="form-label">Número de Llave</label>
                                <input type="number" id="key-number" placeholder="Ej: 1" required>
                                <div id="key-security-alert" style="margin-top: 10px;"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nombre de la Llave (Auto)</label>
                                <input type="text" id="key-name" placeholder="Escriba número para autocompletar"
                                    readonly style="background: #f8fafc;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Persona que solicita</label>
                                <input type="text" id="key-requestor" placeholder="Nombre completo" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Oficial que entrega</label>
                                <input type="text" id="key-officer" list="officers-list"
                                    placeholder="Nombre del oficial" required>
                            </div>
                            <button type="submit" class="btn-submit-action">REGISTRAR PRÉSTAMO</button>
                        </form>
                    </div>
                </aside>
                <section class="monitor-view">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-history" style="color: var(--primary-teal);"></i> Llaves en Préstamo
                                Activo</h3>
                        </div>
                        <div class="monitor-list">
                            <div class="list-head" style="grid-template-columns: 80px 100px 1fr 1fr 1fr 120px;">
                                <span>Num</span>
                                <span>Hora</span>
                                <span>Llave</span>
                                <span>Solicitante</span>
                                <span>Oficial</span>
                                <span>Acción</span>
                            </div>
                            <div id="key-list-body"><!-- Active loans --></div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="card-panel" style="margin-top: 1.5rem;">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-archive" style="color: var(--primary-teal);"></i> Historial y Reportes de
                        Préstamos</h3>
                    <div class="export-actions">
                        <button class="btn-export" onclick="exportKeyHistory('xlsx')"><i class="fas fa-file-excel"></i>
                            Excel</button>
                        <button class="btn-export" style="background: var(--red-holcim);" onclick="window.print()"><i
                                class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="filter-bar" style="grid-template-columns: 100px 1fr 1fr;">
                    <div class="filter-group">
                        <label>Num. Llave</label>
                        <input type="number" id="filter-key-num" placeholder="00">
                    </div>
                    <div class="filter-group">
                        <label>Nombre de Llave</label>
                        <input type="text" id="filter-key-name" placeholder="Ej: Portón 1...">
                    </div>
                    <div class="filter-group">
                        <label>Solicitante</label>
                        <input type="text" id="filter-key-requestor" placeholder="Nombre de la persona...">
                    </div>
                </div>
                <div class="monitor-list">
                    <div class="list-head" style="grid-template-columns: 60px 1fr 1fr 1fr 125px 125px 90px;">
                        <span>Num</span>
                        <span>Llave</span>
                        <span>Solicitante</span>
                        <span>Oficial</span>
                        <span>Préstamo</span>
                        <span>Devolución</span>
                        <span>Estado</span>
                    </div>
                    <div id="key-history-body"><!-- History rows --></div>
                </div>
            </div>
        </div>

        <!-- ===================== PACKAGE MANAGEMENT ===================== -->
        <div id="packages-view" class="view-section" style="display: none;">
            <div class="dashboard-grid">
                <!-- Registration Form -->
                <aside class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-box" style="color: var(--primary-teal);"></i> Registro de Paquetería</h3>
                    </div>
                    <div class="panel-body">
                        <form id="package-form">
                            <div class="form-group">
                                <label class="form-label">Mensajero / Empresa</label>
                                <input type="text" id="pkg-courier" placeholder="DHL, Correos, Emisarios..." required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Destinatario</label>
                                <input type="text" id="pkg-recipient" placeholder="Persona o departamento que recibe"
                                    required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Oficial que Recibe</label>
                                <input type="text" id="pkg-officer" list="officers-list"
                                    placeholder="Nombre del oficial de seguridad" required>
                            </div>
                            <button type="submit" class="btn-submit-action" style="margin-top: 1rem;"><i
                                    class="fas fa-plus"></i> REGISTRAR PAQUETE</button>
                        </form>
                    </div>
                </aside>

                <!-- Pending Package List -->
                <section class="card-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-boxes" style="color: var(--primary-teal);"></i> Paquetes Pendientes de
                            Entrega</h3>
                    </div>
                    <div class="monitor-list">
                        <div class="list-head" style="grid-template-columns: 1fr 1fr 150px 150px 100px;">
                            <span>Mensajería</span>
                            <span>Para</span>
                            <span>Recibido por (Seg)</span>
                            <span>Fecha Recibido</span>
                            <span>Acción</span>
                        </div>
                        <div id="package-list-body" style="max-height: 420px; overflow-y: auto;">
                            <!-- Dynamic Content -->
                        </div>
                    </div>
                </section>
            </div>

            <!-- Delivery History -->
            <div class="card-panel" style="margin-top: 2rem;">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-history" style="color: var(--text-muted);"></i> Historial de Entregas Recientes
                    </h3>
                    <div class="export-actions">
                        <button class="btn-export" onclick="exportPackages('xlsx')"><i class="fas fa-file-excel"></i>
                            Excel</button>
                        <button class="btn-export" style="background: var(--red-holcim);" onclick="window.print()"><i
                                class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="filter-bar" style="grid-template-columns: 1fr 150px 150px 120px;">
                    <div class="filter-group">
                        <label>Buscador (Mensajería/Para)</label>
                        <input type="text" id="pkg-search" placeholder="Buscar...">
                    </div>
                    <div class="filter-group">
                        <label>Desde</label>
                        <input type="date" id="pkg-filter-start">
                    </div>
                    <div class="filter-group">
                        <label>Hasta</label>
                        <input type="date" id="pkg-filter-end">
                    </div>
                    <div class="filter-group">
                        <label>Estado</label>
                        <select id="pkg-filter-status">
                            <option value="ALL">TODOS</option>
                            <option value="PENDIENTE">PENDIENTE</option>
                            <option value="ENTREGADO">ENTREGADO</option>
                        </select>
                    </div>
                </div>
                <div class="monitor-list">
                    <div class="list-head" style="grid-template-columns: 1fr 1fr 150px 150px 150px 150px 80px;">
                        <span>Mensajería</span>
                        <span>Para</span>
                        <span>Recibido por (Seg)</span>
                        <span>Fecha Recibido</span>
                        <span>Entregado a (Per)</span>
                        <span>Fecha Entrega</span>
                        <span>Estado</span>
                    </div>
                    <div id="package-history-body" style="max-height: 300px; overflow-y: auto;">
                        <!-- Dynamic Content -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== FORMS ===================== -->
        <div id="forms-view" class="view-section" style="display: none;">
            <div class="panel-header" style="margin-bottom: 2rem;">
                <h3><i class="fas fa-file-signature" style="color: var(--primary-teal);"></i> Formularios de Reportes
                    Externos</h3>
                <p style="color: var(--text-muted); font-size: 0.8rem;">Acceda rápidamente a las herramientas de reporte
                    oficial de Holcim.</p>
            </div>
            <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
                <div class="card-panel"
                    style="display: flex; flex-direction: column; justify-content: space-between; border-top: 4px solid var(--primary-teal);">
                    <div class="panel-body" style="padding: 2rem; text-align: center;">
                        <i class="fas fa-shield-dog"
                            style="font-size: 3rem; color: var(--primary-teal); margin-bottom: 1.5rem;"></i>
                        <h4 style="font-weight: 800; color: var(--navy-black); margin-bottom: 1rem;">HERRAMIENTA DE
                            REPORTES DE SEGURIDAD K9</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 2rem;">Registro y
                            seguimiento de actividades de seguridad canina en planta.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeUrSKsomZnlLrkRl1-nElYrQ5sAJYGezqr3HDM-6VwK7apig/viewform"
                            target="_blank" class="btn-submit-action"
                            style="text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-external-link-alt"></i> ABRIR FORMULARIO
                        </a>
                    </div>
                </div>
                <div class="card-panel"
                    style="display: flex; flex-direction: column; justify-content: space-between; border-top: 4px solid var(--red-holcim);">
                    <div class="panel-body" style="padding: 2rem; text-align: center;">
                        <i class="fas fa-vial-circle-check"
                            style="font-size: 3rem; color: var(--red-holcim); margin-bottom: 1.5rem;"></i>
                        <h4 style="font-weight: 800; color: var(--navy-black); margin-bottom: 1rem;">REGISTRO DE
                            ALCOHOLEMIAS HOLCIM</h4>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 2rem;">Control y registro
                            de pruebas de alcoholemia preventivas.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSewEdXOev4T8QlHeMa0hfJE3y_BY4IUNIrkpocLVi6wFLFufg/viewform"
                            target="_blank" class="btn-submit-action"
                            style="background: var(--red-holcim); text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-external-link-alt"></i> ABRIR FORMULARIO
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== BASE DE DATOS ===================== -->
        <div id="database-view" class="view-section" style="display: none;">
            <div class="panel-header" style="margin-bottom: 2rem;">
                <h3><i class="fas fa-database" style="color: var(--primary-teal);"></i> Gestión de Base de Datos</h3>
                <p style="color: var(--text-muted); font-size: 0.8rem;">Administre inventarios y directorios maestros
                    del sistema.</p>
            </div>

            <!-- Database Tab Navigation -->
            <div
                style="display: flex; gap: 10px; margin-bottom: 2rem; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                <button class="btn-export db-tab-btn active" onclick="switchDbTab('keys-tab', this)"
                    style="background: var(--navy-black);"><i class="fas fa-key"></i> Inventario de Llaves</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('personnel-tab', this)"
                    style="background: var(--primary-teal);"><i class="fas fa-address-book"></i> Directorio de
                    Personal</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('officers-tab', this)"
                    style="background: #64748b;"><i class="fas fa-shield-alt"></i> Oficiales de Seguridad</button>
                <button class="btn-export db-tab-btn" onclick="switchDbTab('contact-tab', this)"
                    style="background: #e11d48;"><i class="fas fa-phone-alt"></i> Directorio de Planta</button>
            </div>

            <div id="db-tabs-container">
                <!-- Keys Tab -->
                <div id="keys-tab" class="db-tab-content">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-key"></i> Maestro de Llaves</h4>
                        </div>
                        <div class="panel-body">
                            <form id="db-key-form"
                                style="display: grid; grid-template-columns: 80px 1fr 1fr 140px 100px; gap: 10px; align-items: end; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Num</label>
                                    <input type="number" id="db-key-num" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nombre / Ubicación</label>
                                    <input type="text" id="db-key-name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Alerta de Seguridad (Opcional)</label>
                                    <input type="text" id="db-key-alert"
                                        placeholder="Ej: Requiere autorización de Gerencia">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Estado</label>
                                    <select id="db-key-status">
                                        <option value="OPERATIVA">OPERATIVA</option>
                                        <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                        <option value="EXTRAVIADA">EXTRAVIADA</option>
                                        <option value="RESTRINGIDA">RESTRINGIDA</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn-submit-action" style="height: 38px;"><i
                                        class="fas fa-plus"></i></button>
                            </form>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 60px 1fr 120px 80px;">
                                    <span>Num</span>
                                    <span>Ubicación</span>
                                    <span>Estado</span>
                                    <span>Acción</span>
                                </div>
                                <div id="db-key-list-body"><!-- Keys CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personnel Tab -->
                <div id="personnel-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-address-book"></i> Maestro de Personal</h4>
                        </div>
                        <div class="panel-body">
                            <form id="db-person-form"
                                style="display: grid; grid-template-columns: 1fr 1fr 100px; gap: 10px; align-items: end; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Nombre Completo</label>
                                    <input type="text" id="db-person-name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Departamento</label>
                                    <select id="db-person-dept" required>
                                        <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                        <option value="PRODUCCION">PRODUCCION</option>
                                        <option value="CALIDAD">CALIDAD</option>
                                        <option value="ADMINISTRACION">ADMINISTRACION</option>
                                        <option value="H&S">H&S / SALUD Y SEGURIDAD</option>
                                        <option value="PROYECTOS">PROYECTOS</option>
                                        <option value="GEOCYCLE">GEOCYCLE</option>
                                        <option value="LOGISTICA">LOGISTICA</option>
                                        <option value="ALMACEN">ALMACEN</option>
                                        <option value="AMBIENTE">AMBIENTE</option>
                                        <option value="COMUNICACION">COMUNICACION</option>
                                        <option value="CEPAL">CEPAL</option>
                                        <option value="PROVEEDURIA">PROVEEDURIA</option>
                                        <option value="TI">TI / TECNOLOGIA</option>
                                        <option value="CETEC">CETEC</option>
                                        <option value="MINERIA">MINERIA</option>
                                        <option value="SERVICIOS GENERALES">SERVICIOS GENERALES</option>
                                        <option value="OTROS">OTROS</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn-submit-action" style="height: 38px;"><i
                                        class="fas fa-user-plus"></i></button>
                            </form>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 1fr 120px 80px;">
                                    <span>Nombre</span>
                                    <span>Departamento</span>
                                    <span>Acción</span>
                                </div>
                                <div id="db-person-list-body"><!-- Personnel CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Officers Tab -->
                <div id="officers-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-shield-alt"></i> Maestro de Oficiales</h4>
                        </div>
                        <div class="panel-body">
                            <form id="db-officer-form"
                                style="display: grid; grid-template-columns: 1fr 1fr 100px; gap: 10px; align-items: end; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Nombre del Oficial</label>
                                    <input type="text" id="db-officer-name" placeholder="Nombre completo" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Empresa de Seguridad</label>
                                    <input type="text" id="db-officer-company" placeholder="Ej: G4S, Vigilantes..."
                                        required>
                                </div>
                                <button type="submit" class="btn-submit-action" style="height: 38px;"><i
                                        class="fas fa-plus"></i></button>
                            </form>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 1fr 1fr 80px;">
                                    <span>Oficial</span>
                                    <span>Empresa</span>
                                    <span>Acción</span>
                                </div>
                                <div id="db-officer-list-body"><!-- Officers CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Contact Directory Tab -->
                <div id="contact-tab" class="db-tab-content" style="display: none;">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h4><i class="fas fa-phone-alt"></i> Directorio de Contactos de Planta</h4>
                        </div>
                        <div class="panel-body">
                            <div
                                style="background: rgba(225, 29, 72, 0.05); padding: 1.5rem; border-radius: 8px; border: 1px dashed #e11d48; margin-bottom: 2rem;">
                                <h5 style="margin-top: 0; margin-bottom: 1rem; color: #e11d48;"><i
                                        class="fas fa-plus-circle"></i> Registrar Nuevo Contacto</h5>
                                <form id="db-contact-form"
                                    style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 100px; gap: 15px; align-items: end;">
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label">Nombre / Cargo</label>
                                        <input type="text" id="db-contact-name" placeholder="Ej: Jefe de Turno"
                                            required>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label">Departamento</label>
                                        <select id="db-contact-dept" required>
                                            <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                            <option value="PRODUCCION">PRODUCCION</option>
                                            <option value="CALIDAD">CALIDAD</option>
                                            <option value="ADMINISTRACION">ADMINISTRACION</option>
                                            <option value="H&S">H&S / SALUD Y SEGURIDAD</option>
                                            <option value="PROYECTOS">PROYECTOS</option>
                                            <option value="GEOCYCLE">GEOCYCLE</option>
                                            <option value="LOGISTICA">LOGISTICA</option>
                                            <option value="ALMACEN">ALMACEN</option>
                                            <option value="AMBIENTE">AMBIENTE</option>
                                            <option value="COMUNICACION">COMUNICACION</option>
                                            <option value="CEPAL">CEPAL</option>
                                            <option value="PROVEEDURIA">PROVEEDURIA</option>
                                            <option value="TI">TI / TECNOLOGIA</option>
                                            <option value="CETEC">CETEC</option>
                                            <option value="MINERIA">MINERIA</option>
                                            <option value="SERVICIOS GENERALES">SERVICIOS GENERALES</option>
                                            <option value="OTROS">OTROS</option>
                                        </select>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label">Teléfono / Ext</label>
                                        <input type="text" id="db-contact-phone" placeholder="Ej: 8888-8888" required>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label">Canal de Radio</label>
                                        <input type="text" id="db-contact-radio" placeholder="Ej: Canal 5">
                                    </div>
                                    <button type="submit" class="btn-submit-action"
                                        style="height: 42px; background: #e11d48; width: 100%;"><i
                                            class="fas fa-save"></i> GUARDAR</button>
                                </form>
                            </div>
                            <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                                <div class="list-head" style="grid-template-columns: 1fr 120px 120px 100px 80px;">
                                    <span>Nombre</span>
                                    <span>Depto</span>
                                    <span>Teléfono</span>
                                    <span>Radio</span>
                                    <span>Acción</span>
                                </div>
                                <div id="db-contact-list-body"><!-- Contacts CRUD --></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== SETTINGS ===================== -->
        <div id="settings-view" class="view-section" style="display: none;">
            <div class="dashboard-grid" style="grid-template-columns: 400px 1fr;">
                <aside class="card-panel">
                    <div class="panel-header" style="background: var(--primary-teal); color: white;">
                        <h3 style="color: white;"><i class="fas fa-user-circle"></i> Mi Perfil</h3>
                    </div>
                    <div class="panel-body" style="border-bottom: 2px solid var(--border-gray); margin-bottom: 1rem;">
                        <form id="my-profile-form">
                            <div class="form-group">
                                <label class="form-label">Mi Perfil de Sitio</label>
                                <input type="text" id="my-site" placeholder="Ej: Planta Cartago..." required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nueva Contraseña</label>
                                <input type="password" id="my-new-pass" placeholder="Dejar vacío para no cambiar">
                            </div>
                            <button type="submit" class="btn-submit-action"
                                style="background: var(--primary-teal); height: 40px; margin-top: 0.5rem;">ACTUALIZAR
                                MIS DATOS</button>
                        </form>
                    </div>

                    <div class="panel-header">
                        <h3><i class="fas fa-user-shield" style="color: var(--primary-teal);"></i> Gestión de
                            Usuarios
                        </h3>
                    </div>
                    <div class="panel-body">
                        <form id="user-form">
                            <div class="form-group">
                                <label class="form-label">Correo Electrónico</label>
                                <input type="email" id="user-email" placeholder="usuario@gmail.com" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Contraseña</label>
                                <input type="password" id="user-pass" placeholder="••••••••" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Perfil de Sitio</label>
                                <input type="text" id="user-site" placeholder="Ej: Planta Cartago, Cantera..." required>
                            </div>
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label">Permisos de Acceso</label>
                                <div class="premium-permission-grid">
                                    <label class="perm-chip"><input type="checkbox" name="perm" value="dashboard"
                                            checked><span>Acceso</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="reports"><span>Reportes</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="inductions"><span>Inducciones</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="extra-auth"><span>Autorización</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="database"><span>Base de Datos</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="forms"><span>Formularios</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="keys"><span>Llaves</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="packages"><span>Paquetería</span></label>
                                    <label class="perm-chip"><input type="checkbox" name="perm"
                                            value="settings"><span>Config</span></label>
                                </div>
                            </div>
                            <button type="submit" class="btn-submit-action">CREAR PERFIL</button>
                        </form>
                        <div style="margin-top: 2rem; border-top: 1px solid var(--border-gray); padding-top: 1.5rem;">
                            <button class="btn-salida-corpo" id="btn-logout"
                                style="border-color: var(--red-holcim); color: var(--red-holcim); font-weight: 900;">
                                <i class="fas fa-sign-out-alt"></i> CERRAR SESIÓN
                            </button>
                        </div>
                    </div>
                </aside>

                <section class="monitor-view">
                    <div class="card-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-users" style="color: var(--primary-teal);"></i> Cuentas Existentes
                            </h3>
                        </div>
                        <div class="monitor-list" style="margin-top: 1rem;">
                            <div class="list-head" style="grid-template-columns: 1fr 1fr 120px;">
                                <span>Usuario / Correo</span>
                                <span>Permisos Asignados</span>
                                <span>Acción</span>
                            </div>
                            <div id="user-list-body"><!-- Dynamic user rows --></div>
                        </div>
                    </div>

                    <div class="card-panel" style="margin-top: 1.5rem;">
                        <div class="panel-header"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <h3><i class="fas fa-stream" style="color: var(--primary-teal);"></i> Bitácora en Vivo
                                (Actividad del Sistema)</h3>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <select id="log-filter-module"
                                    style="height: 28px; font-size: 0.7rem; width: 120px; font-weight: 700;">
                                    <option value="ALL">MODULO: TODOS</option>
                                    <option value="ACCESO">ACCESO</option>
                                    <option value="LLAVES">LLAVES</option>
                                    <option value="PAQUETERIA">PAQUETERIA</option>
                                    <option value="SISTEMA">SISTEMA</option>
                                    <option value="AUTORIZACIÓN">AUTORIZACIÓN</option>
                                </select>
                                <button class="btn-export"
                                    style="background: var(--text-muted); font-size: 0.65rem; height: 28px;"
                                    onclick="exportEventLog()">
                                    <i class="fas fa-download"></i> EXPORTAR LOG
                                </button>
                            </div>
                        </div>
                        <div class="monitor-list" style="margin-top: 1rem; max-height: 400px; overflow-y: auto;">
                            <div class="list-head" style="grid-template-columns: 140px 100px 100px 1fr;">
                                <span>Fecha / Hora</span>
                                <span>Usuario</span>
                                <span>Módulo</span>
                                <span>Descripción del Evento</span>
                            </div>
                            <div id="live-event-log">
                                <div style="padding: 2rem; text-align: center; color: var(--text-muted);">Iniciando
                                    bitácora de eventos...</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

    </main>

    <!-- Modal Contractor Consolidation -->
    <div id="modal-contractor-hours" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Consolidado Mensual de Contratistas</h3>
                <button class="btn-close-modal" onclick="closeContractorModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="report-meta">
                    <span id="contractor-report-month">---</span>
                    <button class="btn-export" onclick="exportConsolidated()"
                        style="font-size: 0.7rem; padding: 5px 10px;">
                        <i class="fas fa-file-download"></i> Descargar CSV
                    </button>
                </div>
                <div class="monitor-list" style="max-height: 400px; overflow-y: auto;">
                    <div id="contractor-consolidated-body"><!-- Data rows --></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Overtime Alerts -->
    <div id="modal-security-alerts" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 600px;">
            <div class="modal-header" style="background: var(--red-holcim); color: white;">
                <h3 style="color: white;"><i class="fas fa-exclamation-triangle"></i> Personas con Tiempo Excedido
                    (&gt;12h)</h3>
                <button class="btn-close-modal" onclick="closeAlertsModal()" style="color: white;">&times;</button>
            </div>
            <div class="modal-body">
                <div id="alerts-list-body" class="monitor-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Alert rows -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Entry Modal -->
    <div id="modal-edit-entry" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Registro</h3>
                <button class="btn-close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-entry-id">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Nombre Completo</label>
                    <input type="text" id="edit-fullname">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Empresa</label>
                    <input type="text" id="edit-company">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Gafete</label>
                    <input type="text" id="edit-badge">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Departamento</label>
                    <input type="text" id="edit-department">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Responsable Holcim</label>
                    <input type="text" id="edit-responsible">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Placa de Vehículo</label>
                    <input type="text" id="edit-plate">
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label class="form-label">Motivo</label>
                    <input type="text" id="edit-reason">
                </div>
                <button class="btn-submit-action" onclick="saveEntryEdit()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>

    <!-- Traceability / Audit Log Modal -->
    <div id="modal-traceability" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 700px;">
            <div class="modal-header" style="background: var(--navy-black); color: white;">
                <h3 style="color: white;"><i class="fas fa-history"></i> Historial de Trazabilidad de Registro</h3>
                <button class="btn-close-modal" onclick="closeTraceabilityModal()"
                    style="color: white;">&times;</button>
            </div>
            <div class="modal-body">
                <div class="audit-meta"
                    style="margin-bottom: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <span id="trace-record-id" style="font-weight: 700; font-size: 0.8rem;">ID: ---</span>
                        <span id="trace-record-name"
                            style="font-weight: 700; font-size: 0.8rem; text-align: right;">Personal: ---</span>
                    </div>
                </div>
                <div class="monitor-list" style="max-height: 400px; overflow-y: auto;">
                    <div class="list-head" style="grid-template-columns: 140px 140px 100px 1fr 1fr;">
                        <span>Fecha / Hora</span>
                        <span>Usuario</span>
                        <span>Campo</span>
                        <span>Valor Anterior</span>
                        <span>Valor Nuevo</span>
                    </div>
                    <div id="traceability-list-body"><!-- Audit rows --></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Auth Modal -->
    <div id="modal-edit-auth" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Autorización</h3>
                <button class="btn-close-modal" onclick="closeEditAuthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-auth-id">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Beneficiario</label>
                    <input type="text" id="edit-auth-name">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Empresa</label>
                    <input type="text" id="edit-auth-company">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Autoriza</label>
                    <input type="text" id="edit-auth-approver">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="form-group">
                        <label class="form-label">Inicio</label>
                        <input type="date" id="edit-auth-start">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Expira</label>
                        <input type="date" id="edit-auth-end">
                    </div>
                </div>
                <button class="btn-submit-action" onclick="saveAuthEdit()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>

    <!-- Edit Key Loan Modal -->
    <div id="modal-edit-key-loan" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Préstamo de Llave</h3>
                <button class="btn-close-modal" onclick="closeEditKeyModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-key-loan-id">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Solicitante</label>
                    <input type="text" id="edit-key-requestor">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Oficial entrega</label>
                    <input type="text" id="edit-key-officer">
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label class="form-label">Número Llave</label>
                    <input type="number" id="edit-key-num">
                </div>
                <button class="btn-submit-action" onclick="saveKeyLoanEdit()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>

    <!-- Edit Package Modal -->
    <div id="modal-edit-package" class="modal-overlay" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Paquete</h3>
                <button class="btn-close-modal" onclick="closeEditPackageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-package-id">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Mensajería / Courier</label>
                    <input type="text" id="edit-pkg-courier">
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label class="form-label">Destinatario</label>
                    <input type="text" id="edit-pkg-recipient">
                </div>
                <button class="btn-submit-action" onclick="savePackageEdit()">GUARDAR CAMBIOS</button>
            </div>
        </div>
    </div>

    <!-- Scanner Modal -->
    <div id="modal-scanner" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px; padding: 1.5rem;">
            <div class="modal-header"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="margin: 0;"><i class="fas fa-camera" style="color: var(--primary-teal);"></i> Escanear Cédula
                </h3>
                <button onclick="closeScanner()"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
            </div>
            <div id="reader" style="width: 100%; border-radius: 8px; overflow: hidden; background: #000;"></div>
            <p style="text-align: center; color: var(--text-muted); font-size: 0.8rem; margin-top: 1rem;">Enfoque el
                código QR o código de barras de la cédula.</p>
            <button onclick="closeScanner()" class="btn-salida-corpo"
                style="margin-top: 1rem; width: 100%;">CANCELAR</button>
        </div>
    </div>

    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="main.js"></script>
    <script src="packages.js"></script>
    <datalist id="officers-list"><!-- Populated by JS --></datalist>
    <!-- Emergency Directory Modal -->
    <div id="modal-emergency-dir" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <div class="panel-header"
                style="background: #e11d48; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="color: white; margin: 0;"><i class="fas fa-phone-alt"></i> Directorio de Planta</h3>
                <button onclick="closeEmergencyDirectory()"
                    style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="panel-body">
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <div style="position: relative;">
                        <i class="fas fa-search"
                            style="position: absolute; left: 15px; top: 12px; color: var(--text-muted);"></i>
                        <input type="text" id="emergency-dir-search" placeholder="Buscar por nombre o departamento..."
                            style="padding-left: 45px; height: 45px;">
                    </div>
                </div>
                <div class="monitor-list" style="max-height: 400px; overflow-y: auto;">
                    <div class="list-head" style="grid-template-columns: 1fr 120px 120px 100px;">
                        <span>Nombre / Cargo</span>
                        <span>Dpto</span>
                        <span>Teléfono</span>
                        <span>Radio</span>
                    </div>
                    <div id="emergency-dir-body"><!-- Dynamic dynamic rows --></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Personnel Detail Modal (Dashboard Drill-down) -->
    <div id="modal-personnel-detail" class="modal-overlay">
        <div class="modal-content" style="max-width: 900px;">
            <div class="panel-header" id="personnel-detail-header"
                style="background: var(--navy-black); display: flex; justify-content: space-between; align-items: center;">
                <h3 id="personnel-detail-title" style="color: white; margin: 0;">Personal en Planta</h3>
                <button onclick="closePersonnelDetail()"
                    style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="panel-body">
                <div class="monitor-list" style="max-height: 500px; overflow-y: auto;">
                    <div class="list-head" style="grid-template-columns: 120px 1fr 150px 140px 140px;">
                        <span>Cédula</span>
                        <span>Nombre Completo</span>
                        <span>Empresa</span>
                        <span>Departamento</span>
                        <span>Hora Ingreso</span>
                    </div>
                    <div id="personnel-detail-body"><!-- Dynamic rows --></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>